"use strict";function calculateViewportDimensions(){viewportWidth=document.documentElement.clientWidth,viewportHeight=document.documentElement.clientHeight,horizontalViewport=viewportWidth>=viewportHeight,isMobile=!!(viewportWidth<768&&horizontalViewport||viewportHeight<768&&!horizontalViewport),console.log("vh:"+viewportHeight,"vw:"+viewportWidth,"mobile:"+isMobile,"horizontal:"+horizontalViewport),horizontalViewport&&isMobile?($("#change-orientation").show(),$(".menu-icon-container").hide()):initVis()}function initVis(){function e(){for(var e=0;e<g.length;e++){var i=g[e],t=$(i).data(),n=a(t.transitionnum);i.triggerPosition=n,i.played=!1}}function i(e,i){var t=$("#vis").scrollLeft();if(H!=t){H=t;var a=function(e,i){H>=i?$(e).css({background:"#333"}):$(e).css({background:"#9d9d9d"})},r=function(e,i){function t(e,i,t,a,n){return a+(n-a)*(e-i)/(t-i)}var a=t(H,e,i,0,1),n=a>1?1:a,o=Math.round(100*n),r="linear-gradient(90deg, #333 0%, #333 "+o+"%, #9d9d9d "+o+"%)";return r};if(isMobile&&horizontalViewport);else{H>=i[0].position-panelWrapperMargin-n&&!x&&$("#footer").fadeTo("slow",1);for(var s=0;s<i.length;s++)a("#step-dot-"+i[s].step,i[s].position),s>0&&$("#step-line-"+s).css({background:r(i[s-1].position,i[s].position)})}for(var s=0;s<e.length;s++)H>=e[s].animationTrigger&&!e[s].played&&(e[s].startAnimation(),e[s].played=!0);for(var s=0;s<g.length;s++)if(H>=g[s].triggerPosition-n&&!g[s].played){var l=$(g[s]);l.css({"background-image":"url(images/"+journeyConfigs.meta.slug+"/"+o+"_"+l.data().transitionurl+")"})}}}function t(e){var i=a(e);i-=panelWrapperMargin,$("#vis").stop().animate({scrollLeft:i},{duration:1e3,easing:"swing"})}function a(e){var i,t=panelIds.some(function(t,a){return i=a,t.substring(t.length-3)==e});return!!t&&panelPositions[i]}panelWidths=[],panelIds=[],panelPositions=[],panelImageWidths=[],panelTextBlockWidths=[],panelWidthPercent=.9,panelHeightPercent=.7,panelWrapperMargin=40,isMobile&&horizontalViewport?(topVisPadding=10,footerPadding=0,$(".masthead").hide(),$("#footer").hide()):($(".masthead").show(),footerPadding=50,topVisPadding=isMobile?60:100),textBlockPadding=25,mapSidePadding=100,maximumTextPanelWidth=400,panelHeight=viewportHeight-topVisPadding-footerPadding;var n;textPanelWidth=horizontalViewport?viewportHeight*panelHeightPercent>maximumTextPanelWidth?maximumTextPanelWidth:viewportHeight*panelHeightPercent:viewportWidth*panelWidthPercent>maximumTextPanelWidth?maximumTextPanelWidth:viewportWidth*panelWidthPercent;var o=isMobile?600:800,r=$(".container"),s=$("#vis"),l=$(".panels-wrapper"),d=$(".panels-group",s),p=$(".panel",d),h=($(".panel-image",d),$(".panel-text",d));r.css({height:viewportHeight}),s.css({height:viewportHeight-topVisPadding,"padding-top":topVisPadding}),Ps.initialize(document.getElementById("vis")),l.css({height:panelHeight,width:viewportWidth,"margin-left":panelWrapperMargin}),$("#footer").css({margin:"0 "+panelWrapperMargin+"px"});var g=$(".image-transition");g.each(function(){var e=$(this),i=e.attr("id"),t=i.substring(i.length-3),a=(e.data(),"images/"+journeyConfigs.meta.slug+"/"+o+"_"+e.data().transitionurl),n="url("+a+")";$("#transition-"+t).css({"background-image":n})}),p.each(function(e){var i,t=$(this),a=t.data(),r=t.attr("id"),s=r.substring(r.length-3);if("image"==a.type){var l=a.imageurl,d=o+"_"+l,p="url('images/"+journeyConfigs.meta.slug+"/"+d+"')";t.css({"background-image":p});for(var h=0;h<visImageSizes.length;h++)if(d===visImageSizes[h].filename){var g=visImageSizes[h].width/visImageSizes[h].height;i=panelHeight*g;break}panelImageWidths.push(i)}else if("map"==a.type){var c=isMobile?1.1:1.3;i=viewportHeight*c,i+=mapSidePadding,panelImageWidths.push(i)}else"text-overlay"==a.type?i=textPanelWidth:"text-block"==a.type?(i=textPanelWidth+textBlockPadding,panelTextBlockWidths.push(i)):"video"==a.type&&(i=viewportWidth>800?800:viewportWidth);if(r===journeyConfigs.firstPanelId){var u=i;n=viewportWidth-u,t.css({"margin-left":n})}if("text-overlay"!==a.type){var v=panelWrapperMargin+n;0===panelWidths.length&&panelPositions.push(Math.round(v)),panelWidths.push(i),panelIds.push(r);var f=panelWidths.reduce(function(e,i){return e+i});f+=v,f=Math.round(f),panelPositions.push(f)}if("text-block"===a.type)t.css({height:panelHeight,width:i-textBlockPadding,"padding-left":textBlockPadding});else if("map"===a.type)t.css({height:panelHeight,width:i-mapSidePadding,"padding-right":mapSidePadding});else if("video"===a.type){t.css({height:panelHeight,width:i});var m=$("#video-"+s);m.css({height:panelHeight,width:.9*i,"margin-left":.05*i,"margin-right":.05*i});var w,W=m.data();w=isMobile?"sm":"lg";var P="videos/"+journeyConfigs.meta.slug+"/"+W.src+"-"+w+"."+W.format;m.attr("src",P)}else t.css({height:panelHeight,width:i})});for(var c=0;c<h.length;c++){var u=$(h[c]),v=u.attr("id"),f=v.substring(v.length-3);if("text-overlay"==u.data().type){var m=a(f)-panelWrapperMargin;0===c&&(m-=n),u.css({"margin-left":m})}}var w=panelWidths.reduce(function(e,i){return e+i}),W=w+panelWrapperMargin+n;d.css({height:panelHeight,width:W});var P=[];for(var b in journeyConfigs.mapEl)if(journeyConfigs.mapEl.hasOwnProperty(b)){var y=journeyConfigs.mapEl[b],k=a(y.id);y.position=k,y.animationTrigger=isMobile?k:k-viewportWidth/2,y.played=!1,P.push(y)}for(var c=0;c<journeyConfigs.visSteps.length;c++)journeyConfigs.visSteps[c].position=a(journeyConfigs.visSteps[c].id);e();var x=!1,M=!1,H=(Math.floor(W-viewportWidth+panelWrapperMargin),0),C=_.throttle(function(){i(P,journeyConfigs.visSteps)},200);$("#vis").scroll(C),$("body").mousewheel(function(e){var i=$("#vis").scrollLeft();$("#vis").scrollLeft(i-e.deltaY*e.deltaFactor),e.preventDefault()}),document.onkeydown=function(e){e||(e=window.event);var i=e.keyCode;e.charCode&&0===i&&(i=e.charCode);var t=.1*viewportWidth,a=$("#vis").scrollLeft();switch(i){case 37:$("#vis").scrollLeft(a-t);break;case 38:$("#vis").scrollLeft(a-t);break;case 39:$("#vis").scrollLeft(a+t);break;case 40:$("#vis").scrollLeft(a+t);break;case 33:$("#vis").scrollLeft(a-2*t);break;case 34:$("#vis").scrollLeft(a+2*t);break;case 32:$("#vis").scrollLeft(a+2*t)}e.preventDefault()},$(".steps-link").click(function(){var e=$(this),i=e.data().scroll;t(i)}),$("#menu-link").click(function(){$("#menu-cover").fadeTo(500,1),$("#menu-icon").removeClass("fa-bars").addClass("fa-times"),M=!0}),$("#menu-icon").click(function(){M?($(this).removeClass("fa-times").addClass("fa-bars"),$("#menu-cover").fadeTo(500,0,function(){$(this).css({display:"none"})}),M=!1):($(this).removeClass("fa-bars").addClass("fa-times"),$("#menu-cover").fadeTo(500,1),M=!0)}),$("#menu-back").click(function(){$("#menu-cover").fadeTo(500,0,function(){$(this).css({display:"none"})}),$("#menu-icon").removeClass("fa-times").addClass("fa-bars"),M=!1}),$("#vis").fadeTo("slow",1,function(){var e=isMobile?$("#begin-mobile"):$("#begin");setTimeout(function(){e.css({display:"block"})},1500)}),initMaps()}var panelWidths=[],panelIds=[],panelPositions=[],panelImageWidths=[],panelTextBlockWidths=[],viewportWidth,viewportHeight,horizontalViewport,isMobile,panelWidthPercent,panelHeightPercent,panelWrapperMargin,topVisPadding,footerPadding,textBlockPadding,mapSidePadding,maximumTextPanelWidth,panelHeight,textPanelWidth;$(document).ready(function(){calculateViewportDimensions()}),$(window).on("resize",_.debounce(function(){$("#change-orientation").hide(),$(".menu-icon-container").show(),calculateViewportDimensions()},500));