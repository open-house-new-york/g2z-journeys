"use strict";function calculateViewportDimensions(){var e=document.documentElement.clientWidth,i=document.documentElement.clientHeight,t=e>=i,s=!!(e<768&&t||i<768&&!t);console.log("vh:"+i,"vw:"+e,"mobile:"+s,"horizontal:"+t),t&&s?($("#change-orientation").show(),$(".menu-icon-container").hide()):initVis(e,i,t,s)}function initVis(e,i,t,s){function a(){for(var e=0;e<P.length;e++){var i=P[e],t=$(i).data(),s=o(t.transitionnum);i.triggerPosition=s,i.played=!1}}function n(e,i){var t=$("#vis").scrollLeft();if(K!=t){K=t;for(var s=0;s<e.length;s++)K>=e[s].animationTrigger&&!e[s].played&&(e[s].startAnimation(),e[s].played=!0);for(var s=0;s<P.length;s++)if(K>=P[s].triggerPosition-L&&!P[s].played){var a=$(P[s]);a.css({"background-image":"url(images/"+journeyConfigs.meta.slug+"/"+j+"_"+a.data().transitionurl+")"})}}}function r(e){var i=o(e);i-=u,$("#vis").stop().animate({scrollLeft:i},{duration:1e3,easing:"swing"})}function o(e){var i,t=b.some(function(t,s){return i=s,t.substring(t.length-3)==e});return!!t&&w[i]}var l,c,u,f,d,g,v,h,m,p,y=[],b=[],w=[],k=[],C=[];l=.9,c=.7,u=40,s&&t?(f=10,d=0,$(".masthead").hide(),$("#footer").hide()):($(".masthead").show(),d=50,f=s?60:100),i<=480&&(f=40,l=.7),g=25,v=100,h=400,m=i-f-20;var L;p=t?i*c>h?h:i*c:e*l>h?h:e*l;var j=s?600:800;"history"===journeyConfigs.meta.slug&&(j=600);var S=$(".container"),x=$("#vis"),T=$(".panels-wrapper"),z=$(".panels-group",x),E=$(".panel",z),I=($(".panel-image",z),$(".panel-text",z));S.css({height:i}),x.css({height:i-f,"padding-top":f}),Ps.initialize(document.getElementById("vis"),{handlers:["click-rail","drag-scrollbar","keyboard","wheel","touch"],suppressScrollY:!0,minScrollbarLength:50});var D=!1;document.addEventListener("ps-x-reach-end",function(){D&&"done"!==D&&($("#menu-link").fadeTo("slow",1),D="done"),"done"!==D&&(D=!0)}),T.css({height:m,width:e,"margin-left":u}),$("#footer").css({margin:"0 "+u+"px"});var P=$(".image-transition");P.each(function(){var e=$(this),i=e.attr("id"),t=i.substring(i.length-3),s=(e.data(),"images/"+journeyConfigs.meta.slug+"/"+j+"_"+e.data().transitionurl),a="url("+s+")";$("#transition-"+t).css({"background-image":a})}),E.each(function(t){var a,n=$(this),r=n.data(),o=n.attr("id"),l=o.substring(o.length-3);if("image"==r.type){var c=r.imageurl,f=j+"_"+c,d="url('images/"+journeyConfigs.meta.slug+"/"+f+"')";n.css({"background-image":d});for(var h=0;h<visImageSizes.length;h++)if(f===visImageSizes[h].filename){var S=visImageSizes[h].width/visImageSizes[h].height;a=m*S;break}k.push(a)}else if("map"==r.type){var x=s?1.1:1.3;a=i*x,a+=v,k.push(a)}else"text-overlay"==r.type?a=p:"text-block"==r.type?(a=p+g,C.push(a)):"video"==r.type&&(a=e>800?800:e);if(o===journeyConfigs.firstPanelId){var T=a;L=e-T,n.css({"margin-left":L})}if("text-overlay"!==r.type){var z=u+L;0===y.length&&w.push(Math.round(z)),y.push(a),b.push(o);var E=y.reduce(function(e,i){return e+i});E+=z,E=Math.round(E),w.push(E)}if("text-block"===r.type)n.css({height:m,width:a-g,"padding-left":g});else if("map"===r.type)n.css({height:m,width:a-v,"padding-right":v});else if("video"===r.type){n.css({height:m,width:a});var I=$("#video-"+l);I.css({height:m,width:.9*a,"margin-left":.05*a,"margin-right":.05*a});var D,P=I.data();D=s?"sm":"lg";var V="videos/"+journeyConfigs.meta.slug+"/"+P.src+"-"+D+"."+P.format;I.attr("src",V)}else n.css({height:m,width:a})});for(var V=0;V<I.length;V++){var M=$(I[V]),Y=M.attr("id"),A=Y.substring(Y.length-3);if("text-overlay"==M.data().type){var B=o(A)-u;0===V&&(B-=L),M.css({"margin-left":B})}}var F=y.reduce(function(e,i){return e+i}),H=F+u+L;z.css({height:m,width:H});var O=[];for(var W in journeyConfigs.mapEl)if(journeyConfigs.mapEl.hasOwnProperty(W)){var q=journeyConfigs.mapEl[W],G=o(q.id);q.position=G,q.animationTrigger=s?G:G-e/2,q.played=!1,O.push(q)}for(var V=0;V<journeyConfigs.visSteps.length;V++)journeyConfigs.visSteps[V].position=o(journeyConfigs.visSteps[V].id);a();var J=!1,K=(Math.floor(H-e+u),0),N=_.throttle(function(){n(O,journeyConfigs.visSteps)},200);if($("#vis").scroll(N),$("body").mousewheel(function(e){var i=$("#vis").scrollLeft();$("#vis").scrollLeft(i-e.deltaY*e.deltaFactor),e.preventDefault()}),document.onkeydown=function(i){i||(i=window.event);var t=i.keyCode;i.charCode&&0===t&&(t=i.charCode);var s=.1*e,a=$("#vis").scrollLeft();switch(t){case 37:$("#vis").scrollLeft(a-s);break;case 38:$("#vis").scrollLeft(a-s);break;case 39:$("#vis").scrollLeft(a+s);break;case 40:$("#vis").scrollLeft(a+s);break;case 33:$("#vis").scrollLeft(a-2*s);break;case 34:$("#vis").scrollLeft(a+2*s);break;case 32:$("#vis").scrollLeft(a+2*s)}i.preventDefault()},$(".steps-link").click(function(){var e=$(this),i=e.data().scroll;r(i)}),$("#menu-link").click(function(){$("#menu-cover").fadeTo(500,1),$("#menu-icon").removeClass("fa-bars").addClass("fa-times"),J=!0}),$("#menu-icon").click(function(){J?($(this).removeClass("fa-times").addClass("fa-bars"),$("#menu-cover").fadeTo(500,0,function(){$(this).css({display:"none"})}),J=!1):($(this).removeClass("fa-bars").addClass("fa-times"),$("#menu-cover").fadeTo(500,1),J=!0)}),$("#menu-back").click(function(){$("#menu-cover").fadeTo(500,0,function(){$(this).css({display:"none"})}),$("#menu-icon").removeClass("fa-times").addClass("fa-bars"),J=!1}),$("#vis").fadeTo("slow",1,function(){var e=s?$("#begin-mobile"):$("#begin");setTimeout(function(){e.css({display:"block"})},1500)}),initMaps(e,i,t,s,l,c,u,f,d,g,v,h,m,p),$("#vis").scrollLeft()>=F-e){var K=$("#vis").scrollLeft(),Q=K+e-F;$("#vis").scrollLeft(K-Q)}}$(document).ready(function(){calculateViewportDimensions()}),$(window).on("resize",_.debounce(function(){$("#change-orientation").hide(),$(".menu-icon-container").show(),$(".ps-scrollbar-x-rail, .ps-scrollbar-y-rail").remove(),calculateViewportDimensions()},500));