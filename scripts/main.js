"use strict";function calculateViewportDimensions(){var e=document.documentElement.clientWidth,i=document.documentElement.clientHeight,a=e>=i,n=!!(e<768&&a||i<768&&!a);console.log("vh:"+i,"vw:"+e,"mobile:"+n,"horizontal:"+a),a&&n?($("#change-orientation").show(),$(".menu-icon-container").hide()):initVis(e,i,a,n)}function initVis(e,i,a,n){function t(){for(var e=0;e<A.length;e++){var i=A[e],a=$(i).data(),n=d(a.transitionnum);i.triggerPosition=n,i.played=!1}}function o(e,i){var a=$("#vis").scrollLeft();if(Z!=a){Z=a;for(var n=0;n<e.length;n++)Z>=e[n].animationTrigger&&!e[n].played&&(e[n].startAnimation(),e[n].played=!0);for(var n=0;n<A.length;n++)if(Z>=A[n].triggerPosition&&!A[n].played){var t=$(A[n]),o=t.data().imageurl,r=t.data().transitionurl;t.data().loop===!0?(s(o,r,t,2500),A[n].played=!0):t.css({"background-image":"url(images/"+journeyConfigs.meta.slug+"/"+I+"_"+r+")"})}}}function s(e,i,a,n){function t(){a.css({"background-image":"url(images/"+journeyConfigs.meta.slug+"/"+I+"_"+i+")"}),setTimeout(o,n)}function o(){a.css({"background-image":"url(images/"+journeyConfigs.meta.slug+"/"+I+"_"+e+")"}),setTimeout(t,n)}t()}function r(){$("#menu-icon").removeClass("fa-bars").addClass("fa-times"),$("#menu-cover").fadeTo(500,1),U=!0}function c(){$("#menu-icon").removeClass("fa-times").addClass("fa-bars"),$("#menu-cover").fadeTo(500,0,function(){$("#menu-cover").css({display:"none"})}),U=!1}function l(){$("#menu-icon").removeClass("fa-times").addClass("fa-bars"),$("#action-cover").fadeTo(500,0,function(){$("#action-cover").css({display:"none"})}),X=!1}function u(e){var i=d(e);i-=g,$("#vis").stop().animate({scrollLeft:i},{duration:1e3,easing:"swing"})}function d(e){var i,a=T.some(function(a,n){i=n;var t=f(a);return t==e});return!!a&&j[i]}function f(e){var i=e.split("-");return i[1]+"-"+i[2]}var m,v,g,h,p,y,b,k,w,C,L=[],T=[],j=[],x=[],E=[];m=.9,v=.7,g=40,n&&a?(h=10,p=0,$(".masthead").hide(),$("#footer").hide()):($(".masthead").show(),p=50,h=n?60:100),i<=480&&(h=40,m=.7),y=25,b=100,k=400,w=i-h-20;var z;C=a?i*v>k?k:i*v:e*m>k?k:e*m;var I=n?600:800,S=$(".container"),D=$("#vis"),P=$(".panels-wrapper"),V=$(".panels-group",D);i<540?$(".not-mobile",V).remove():$(".mobile",V).remove();var M=$(".panel",V),B=($(".panel-image",V),$(".panel-text",V));S.css({height:i}),D.css({height:i-h,"padding-top":h}),Ps.initialize(document.getElementById("vis"),{handlers:["click-rail","drag-scrollbar","keyboard","wheel","touch"],suppressScrollY:!0,minScrollbarLength:50});var Y=!1;document.addEventListener("ps-x-reach-end",function(){Y&&"done"!==Y&&($("#menu-link").fadeTo("slow",1),Y="done"),"done"!==Y&&(Y=!0)}),P.css({height:w,width:e,"margin-left":g}),$("#footer").css({margin:"0 "+g+"px"});var A=$(".image-transition");A.each(function(){var e=$(this),i=e.attr("id"),a=f(i),n=e.data(),t="images/"+journeyConfigs.meta.slug+"/"+I+"_"+e.data().transitionurl,o="url("+t+")";$("#transition-"+a).css({"background-image":o});var s=[n.imageurl,n.transitionurl],r=0,c=!1;n.loop||e.click(function(){if(!c){c=!0;var i=r%2;e.css({"background-image":"url(images/"+journeyConfigs.meta.slug+"/"+I+"_"+s[i]+")"}),r++,setTimeout(function(){c=!1},1500)}})}),M.each(function(t){var o,s=$(this),r=s.data(),c=s.attr("id"),l=f(c);if("image"==r.type){var u=r.imageurl,d=I+"_"+u,m="url('images/"+journeyConfigs.meta.slug+"/"+d+"')";s.css({"background-image":m});for(var v=0;v<visImageSizes.length;v++)if(d===visImageSizes[v].filename){var h=visImageSizes[v].width/visImageSizes[v].height;o=w*h;break}x.push(o)}else if("map"==r.type){var p=n?1.1:1.3;o=i*p,o+=b,x.push(o)}else"text-overlay"==r.type?o=C:"text-block"==r.type?(o=C+y,E.push(o)):"video"==r.type&&(o=e>800?720:.9*e);if(c===journeyConfigs.firstPanelId){var k=o;z=e-k,s.css({"margin-left":z})}if("text-overlay"!==r.type){var _=g+z;0===L.length&&j.push(Math.round(_)),L.push(o),T.push(c);var S=L.reduce(function(e,i){return e+i});S+=_,S=Math.round(S),j.push(S)}if("text-block"===r.type)s.css({height:w,width:o-y,"padding-left":y});else if("map"===r.type)s.css({height:w,width:o-b,"padding-right":b});else if("video"===r.type){var D="url('videos/"+journeyConfigs.meta.slug+"/"+r.imageurl+"')",P=.75,V=o*P,M=(w-V)/2;s.css({height:V,width:o,"margin-top":M,"background-image":D});var B=$("#video-"+l);if(a){var Y=.9*i,A=Y/P;$(".video-container").css({width:A}),B.css({height:Y})}else{var A=n?.9*e:e;$(".video-container").css({width:A}),B.css({width:A})}var F,H=B.data();F=n?"sm":"lg";var O="videos/"+journeyConfigs.meta.slug+"/"+H.src+"-"+F+"."+H.format;B.attr("src",O),s.click(function(){$("#video-cover-"+l).show(),document.getElementById("video-"+l).play()})}else s.css({height:w,width:o})});for(var F=0;F<B.length;F++){var H=$(B[F]),O=H.attr("id"),W=f(O);if("text-overlay"==H.data().type){var q=d(W)-g;0===F&&(q-=z),H.css({"margin-left":q})}}var G=L.reduce(function(e,i){return e+i}),J=G+g+z;V.css({height:w,width:J});var K=[];for(var N in journeyConfigs.mapEl)if(journeyConfigs.mapEl.hasOwnProperty(N)){var Q=journeyConfigs.mapEl[N],R=d(Q.id);Q.position=R,Q.animationTrigger=n?R:R-e/2,Q.played=!1,K.push(Q)}t();var U=!1,X=!1,Z=(Math.floor(J-e+g),0),ee=_.throttle(function(){o(K)},200);$("#vis").scroll(ee),$("body").mousewheel(function(e){var i=$("#vis").scrollLeft();$("#vis").scrollLeft(i-e.deltaY*e.deltaFactor),e.preventDefault()}),document.onkeydown=function(i){i||(i=window.event);var a=i.keyCode;i.charCode&&0===a&&(a=i.charCode);var n=.1*e,t=$("#vis").scrollLeft();switch(a){case 37:$("#vis").scrollLeft(t-n);break;case 38:$("#vis").scrollLeft(t-n);break;case 39:$("#vis").scrollLeft(t+n);break;case 40:$("#vis").scrollLeft(t+n);break;case 33:$("#vis").scrollLeft(t-2*n);break;case 34:$("#vis").scrollLeft(t+2*n);break;case 32:$("#vis").scrollLeft(t+2*n);break;case 27:U&&c();break;default:return}i.preventDefault()},$(".steps-link").click(function(){var e=$(this),i=e.data().scroll;u(i)}),$("#menu-link").click(function(){$("#menu-cover").fadeTo(500,1),$("#menu-icon").removeClass("fa-bars").addClass("fa-times"),U=!0}),$("#menu-link-from-action").click(function(){$("#action-cover").fadeTo(500,0,function(){$("#action-cover").css({display:"none"})}),$("#menu-cover").fadeTo(500,1),X=!1,U=!0}),$("#action-link").click(function(){$("#action-cover").fadeTo(500,1),$("#menu-icon").removeClass("fa-bars").addClass("fa-times"),X=!0}),$("#menu-icon").click(function(){U?c():X?l():r()});for(var ie=$("#menu > a"),F=0;F<ie.length;F++){var ae=$(ie[F]),ne=ae.attr("id");ne==="menu-"+journeyConfigs.meta.slug&&(ae.attr("href","#"),ae.addClass("disabled"),ae.find("div > h3").addClass("highlight"))}if($("#menu-back").click(function(){$("#menu-cover").fadeTo(500,0,function(){$(this).css({display:"none"})}),$("#menu-icon").removeClass("fa-times").addClass("fa-bars"),U=!1}),$("#vis").fadeTo("slow",1,function(){var e=n?$("#begin-mobile"):$("#begin");setTimeout(function(){e.css({display:"block"})},1500)}),$(".video-wrapper").click(function(e){e.target===this&&$(this).parent().parent().hide()}),$(".modal-cover").click(function(e){e.target===this&&$(this).hide()}),initMaps(e,i,a,n,m,v,g,h,p,y,b,k,w,C),$("#vis").scrollLeft()>=G-e){var Z=$("#vis").scrollLeft(),te=Z+e-G;$("#vis").scrollLeft(Z-te)}}$(document).ready(function(){calculateViewportDimensions()}),$(window).on("resize",_.debounce(function(){$("#change-orientation").hide(),$(".menu-icon-container").show(),$(".ps-scrollbar-x-rail, .ps-scrollbar-y-rail").remove(),calculateViewportDimensions()},500));