"use strict";function calculateViewportDimensions(){var e=document.documentElement.clientWidth,i=document.documentElement.clientHeight,a=e>=i,n=!!(e<768&&a||i<768&&!a);console.log("vh:"+i,"vw:"+e,"mobile:"+n,"horizontal:"+a),a&&n?($("#change-orientation").show(),$(".menu-icon-container").hide()):initVis(e,i,a,n)}function initVis(e,i,a,n){function t(){for(var e=0;e<Y.length;e++){var i=Y[e],a=$(i).data(),n=d(a.transitionnum);i.triggerPosition=n,i.played=!1}}function s(e,i){var a=$("#vis").scrollLeft();if(X!=a){X=a;for(var n=0;n<e.length;n++)X>=e[n].animationTrigger&&!e[n].played&&(e[n].startAnimation(),e[n].played=!0);for(var n=0;n<Y.length;n++)if(X>=Y[n].triggerPosition&&!Y[n].played){var t=$(Y[n]),s=t.data().imageurl,r=t.data().transitionurl;t.data().loop===!0?(o(s,r,t,2500),Y[n].played=!0):t.css({"background-image":"url(images/"+journeyConfigs.meta.slug+"/"+z+"_"+r+")"})}}}function o(e,i,a,n){function t(){a.css({"background-image":"url(images/"+journeyConfigs.meta.slug+"/"+z+"_"+i+")"}),setTimeout(s,n)}function s(){a.css({"background-image":"url(images/"+journeyConfigs.meta.slug+"/"+z+"_"+e+")"}),setTimeout(t,n)}t()}function r(){$("#menu-icon").removeClass("fa-bars").addClass("fa-times"),$("#menu-cover").fadeTo(500,1),R=!0}function c(){$("#menu-icon").removeClass("fa-times").addClass("fa-bars"),$("#menu-cover").fadeTo(500,0,function(){$("#menu-cover").css({display:"none"})}),R=!1}function l(){$("#menu-icon").removeClass("fa-times").addClass("fa-bars"),$("#action-cover").fadeTo(500,0,function(){$("#action-cover").css({display:"none"})}),U=!1}function u(e){var i=d(e);i-=g,$("#vis").stop().animate({scrollLeft:i},{duration:1e3,easing:"swing"})}function d(e){var i,a=L.some(function(a,n){return i=n,a.substring(a.length-3)==e});return!!a&&T[i]}var f,m,g,v,h,p,y,b,k,w,C=[],L=[],T=[],j=[],x=[];f=.9,m=.7,g=40,n&&a?(v=10,h=0,$(".masthead").hide(),$("#footer").hide()):($(".masthead").show(),h=50,v=n?60:100),i<=480&&(v=40,f=.7),p=25,y=100,b=400,k=i-v-20;var E;w=a?i*m>b?b:i*m:e*f>b?b:e*f;var z=n?600:800,I=$(".container"),S=$("#vis"),D=$(".panels-wrapper"),P=$(".panels-group",S);i<540?$(".not-mobile",P).remove():$(".mobile",P).remove();var V=$(".panel",P),M=($(".panel-image",P),$(".panel-text",P));I.css({height:i}),S.css({height:i-v,"padding-top":v}),Ps.initialize(document.getElementById("vis"),{handlers:["click-rail","drag-scrollbar","keyboard","wheel","touch"],suppressScrollY:!0,minScrollbarLength:50});var B=!1;document.addEventListener("ps-x-reach-end",function(){B&&"done"!==B&&($("#menu-link").fadeTo("slow",1),B="done"),"done"!==B&&(B=!0)}),D.css({height:k,width:e,"margin-left":g}),$("#footer").css({margin:"0 "+g+"px"});var Y=$(".image-transition");Y.each(function(){var e=$(this),i=e.attr("id"),a=i.substring(i.length-3),n=e.data(),t="images/"+journeyConfigs.meta.slug+"/"+z+"_"+e.data().transitionurl,s="url("+t+")";$("#transition-"+a).css({"background-image":s});var o=[n.imageurl,n.transitionurl],r=0,c=!1;n.loop||e.click(function(){if(!c){c=!0;var i=r%2;e.css({"background-image":"url(images/"+journeyConfigs.meta.slug+"/"+z+"_"+o[i]+")"}),r++,setTimeout(function(){c=!1},1500)}})}),V.each(function(t){var s,o=$(this),r=o.data(),c=o.attr("id"),l=c.substring(c.length-3);if("image"==r.type){var u=r.imageurl,d=z+"_"+u,f="url('images/"+journeyConfigs.meta.slug+"/"+d+"')";o.css({"background-image":f});for(var m=0;m<visImageSizes.length;m++)if(d===visImageSizes[m].filename){var v=visImageSizes[m].width/visImageSizes[m].height;s=k*v;break}j.push(s)}else if("map"==r.type){var h=n?1.1:1.3;s=i*h,s+=y,j.push(s)}else"text-overlay"==r.type?s=w:"text-block"==r.type?(s=w+p,x.push(s)):"video"==r.type&&(s=e>800?720:.9*e);if(c===journeyConfigs.firstPanelId){var b=s;E=e-b,o.css({"margin-left":E})}if("text-overlay"!==r.type){var _=g+E;0===C.length&&T.push(Math.round(_)),C.push(s),L.push(c);var I=C.reduce(function(e,i){return e+i});I+=_,I=Math.round(I),T.push(I)}if("text-block"===r.type)o.css({height:k,width:s-p,"padding-left":p});else if("map"===r.type)o.css({height:k,width:s-y,"padding-right":y});else if("video"===r.type){var S="url('videos/"+journeyConfigs.meta.slug+"/"+r.imageurl+"')",D=.75,P=s*D,V=(k-P)/2;o.css({height:P,width:s,"margin-top":V,"background-image":S});var M=$("#video-"+l);if(a){var B=.9*i,Y=B/D;$(".video-container").css({width:Y}),M.css({height:B})}else{var Y=n?.9*e:e;$(".video-container").css({width:Y}),M.css({width:Y})}var A,F=M.data();A=n?"sm":"lg";var H="videos/"+journeyConfigs.meta.slug+"/"+F.src+"-"+A+"."+F.format;M.attr("src",H),o.click(function(){$("#video-cover-"+l).show(),document.getElementById("video-"+l).play()})}else o.css({height:k,width:s})});for(var A=0;A<M.length;A++){var F=$(M[A]),H=F.attr("id"),O=H.substring(H.length-3);if("text-overlay"==F.data().type){var W=d(O)-g;0===A&&(W-=E),F.css({"margin-left":W})}}var q=C.reduce(function(e,i){return e+i}),G=q+g+E;P.css({height:k,width:G});var J=[];for(var K in journeyConfigs.mapEl)if(journeyConfigs.mapEl.hasOwnProperty(K)){var N=journeyConfigs.mapEl[K],Q=d(N.id);N.position=Q,N.animationTrigger=n?Q:Q-e/2,N.played=!1,J.push(N)}t();var R=!1,U=!1,X=(Math.floor(G-e+g),0),Z=_.throttle(function(){s(J)},200);$("#vis").scroll(Z),$("body").mousewheel(function(e){var i=$("#vis").scrollLeft();$("#vis").scrollLeft(i-e.deltaY*e.deltaFactor),e.preventDefault()}),document.onkeydown=function(i){i||(i=window.event);var a=i.keyCode;i.charCode&&0===a&&(a=i.charCode);var n=.1*e,t=$("#vis").scrollLeft();switch(a){case 37:$("#vis").scrollLeft(t-n);break;case 38:$("#vis").scrollLeft(t-n);break;case 39:$("#vis").scrollLeft(t+n);break;case 40:$("#vis").scrollLeft(t+n);break;case 33:$("#vis").scrollLeft(t-2*n);break;case 34:$("#vis").scrollLeft(t+2*n);break;case 32:$("#vis").scrollLeft(t+2*n);break;case 27:R&&c();break;default:return}i.preventDefault()},$(".steps-link").click(function(){var e=$(this),i=e.data().scroll;u(i)}),$("#menu-link").click(function(){$("#menu-cover").fadeTo(500,1),$("#menu-icon").removeClass("fa-bars").addClass("fa-times"),R=!0}),$("#menu-link-from-action").click(function(){$("#action-cover").fadeTo(500,0,function(){$("#action-cover").css({display:"none"})}),$("#menu-cover").fadeTo(500,1),U=!1,R=!0}),$("#action-link").click(function(){$("#action-cover").fadeTo(500,1),$("#menu-icon").removeClass("fa-bars").addClass("fa-times"),U=!0}),$("#menu-icon").click(function(){R?c():U?l():r()});for(var ee=$("#menu > a"),A=0;A<ee.length;A++){var ie=$(ee[A]),ae=ie.attr("id");ae==="menu-"+journeyConfigs.meta.slug&&(ie.attr("href","#"),ie.addClass("disabled"),ie.find("div > h3").addClass("highlight"))}if($("#menu-back").click(function(){$("#menu-cover").fadeTo(500,0,function(){$(this).css({display:"none"})}),$("#menu-icon").removeClass("fa-times").addClass("fa-bars"),R=!1}),$("#vis").fadeTo("slow",1,function(){var e=n?$("#begin-mobile"):$("#begin");setTimeout(function(){e.css({display:"block"})},1500)}),$(".video-wrapper").click(function(e){e.target===this&&$(this).parent().parent().hide()}),$(".modal-cover").click(function(e){e.target===this&&$(this).hide()}),initMaps(e,i,a,n,f,m,g,v,h,p,y,b,k,w),$("#vis").scrollLeft()>=q-e){var X=$("#vis").scrollLeft(),ne=X+e-q;$("#vis").scrollLeft(X-ne)}}$(document).ready(function(){calculateViewportDimensions()}),$(window).on("resize",_.debounce(function(){$("#change-orientation").hide(),$(".menu-icon-container").show(),$(".ps-scrollbar-x-rail, .ps-scrollbar-y-rail").remove(),calculateViewportDimensions()},500));