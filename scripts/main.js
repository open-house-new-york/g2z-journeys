"use strict";function calculateViewportDimensions(){var e=document.documentElement.clientWidth,i=document.documentElement.clientHeight,t=e>=i,n=!!(e<768&&t||i<768&&!t);console.log("vh:"+i,"vw:"+e,"mobile:"+n,"horizontal:"+t),t&&n?($("#change-orientation").show(),$(".menu-icon-container").hide()):initVis(e,i,t,n)}function initVis(e,i,t,n){function a(){for(var e=0;e<B.length;e++){var i=B[e],t=$(i).data(),n=u(t.transitionnum);i.triggerPosition=n,i.played=!1}}function s(e,i){var t=$("#vis").scrollLeft();if(R!=t){R=t;for(var n=0;n<e.length;n++)R>=e[n].animationTrigger&&!e[n].played&&(e[n].startAnimation(),e[n].played=!0);for(var n=0;n<B.length;n++)if(R>=B[n].triggerPosition&&!B[n].played){var a=$(B[n]),s=a.data().imageurl,r=a.data().transitionurl;a.data().loop===!0?(o(s,r,a,2500),B[n].played=!0):a.css({"background-image":"url(images/"+journeyConfigs.meta.slug+"/"+x+"_"+r+")"})}}}function o(e,i,t,n){function a(){t.css({"background-image":"url(images/"+journeyConfigs.meta.slug+"/"+x+"_"+i+")"}),setTimeout(s,n)}function s(){t.css({"background-image":"url(images/"+journeyConfigs.meta.slug+"/"+x+"_"+e+")"}),setTimeout(a,n)}a()}function r(){$("#menu-icon").removeClass("fa-bars").addClass("fa-times"),$("#menu-cover").fadeTo(500,1),Q=!0}function l(){$("#menu-icon").removeClass("fa-times").addClass("fa-bars"),$("#menu-cover").fadeTo(500,0,function(){$("#menu-cover").css({display:"none"})}),Q=!1}function c(e){var i=u(e);i-=g,$("#vis").stop().animate({scrollLeft:i},{duration:1e3,easing:"swing"})}function u(e){var i,t=C.some(function(t,n){return i=n,t.substring(t.length-3)==e});return!!t&&j[i]}var d,f,g,v,m,h,p,y,b,k,w=[],C=[],j=[],L=[],T=[];d=.9,f=.7,g=40,n&&t?(v=10,m=0,$(".masthead").hide(),$("#footer").hide()):($(".masthead").show(),m=50,v=n?60:100),i<=480&&(v=40,d=.7),h=25,p=100,y=400,b=i-v-20;var S;k=t?i*f>y?y:i*f:e*d>y?y:e*d;var x=n?600:800,E=$(".container"),z=$("#vis"),I=$(".panels-wrapper"),D=$(".panels-group",z),P=$(".panel",D),V=($(".panel-image",D),$(".panel-text",D));E.css({height:i}),z.css({height:i-v,"padding-top":v}),Ps.initialize(document.getElementById("vis"),{handlers:["click-rail","drag-scrollbar","keyboard","wheel","touch"],suppressScrollY:!0,minScrollbarLength:50});var M=!1;document.addEventListener("ps-x-reach-end",function(){M&&"done"!==M&&($("#menu-link").fadeTo("slow",1),M="done"),"done"!==M&&(M=!0)}),I.css({height:b,width:e,"margin-left":g}),$("#footer").css({margin:"0 "+g+"px"});var B=$(".image-transition");B.each(function(){var e=$(this),i=e.attr("id"),t=i.substring(i.length-3),n=e.data(),a="images/"+journeyConfigs.meta.slug+"/"+x+"_"+e.data().transitionurl,s="url("+a+")";$("#transition-"+t).css({"background-image":s});var o=[n.imageurl,n.transitionurl],r=0,l=!1;n.loop||e.click(function(){if(!l){l=!0;var i=r%2;e.css({"background-image":"url(images/"+journeyConfigs.meta.slug+"/"+x+"_"+o[i]+")"}),r++,setTimeout(function(){l=!1},1500)}})}),P.each(function(a){var s,o=$(this),r=o.data(),l=o.attr("id"),c=l.substring(l.length-3);if("image"==r.type){var u=r.imageurl,d=x+"_"+u,f="url('images/"+journeyConfigs.meta.slug+"/"+d+"')";o.css({"background-image":f});for(var v=0;v<visImageSizes.length;v++)if(d===visImageSizes[v].filename){var m=visImageSizes[v].width/visImageSizes[v].height;s=b*m;break}L.push(s)}else if("map"==r.type){var y=n?1.1:1.3;s=i*y,s+=p,L.push(s)}else"text-overlay"==r.type?s=k:"text-block"==r.type?(s=k+h,T.push(s)):"video"==r.type&&(s=e>800?720:.9*e);if(l===journeyConfigs.firstPanelId){var E=s;S=e-E,o.css({"margin-left":S})}if("text-overlay"!==r.type){var _=g+S;0===w.length&&j.push(Math.round(_)),w.push(s),C.push(l);var z=w.reduce(function(e,i){return e+i});z+=_,z=Math.round(z),j.push(z)}if("text-block"===r.type)o.css({height:b,width:s-h,"padding-left":h});else if("map"===r.type)o.css({height:b,width:s-p,"padding-right":p});else if("video"===r.type){var I="url('videos/"+journeyConfigs.meta.slug+"/"+r.imageurl+"')",D=.75,P=s*D,V=(b-P)/2;o.css({height:P,width:s,"margin-top":V,"background-image":I});var M=$("#video-"+c);if(t){var B=.9*i,Y=B/D;$(".video-container").css({width:Y}),M.css({height:B})}else{var Y=n?.9*e:e;$(".video-container").css({width:Y}),M.css({width:Y})}var A,F=M.data();A=n?"sm":"lg";var H="videos/"+journeyConfigs.meta.slug+"/"+F.src+"-"+A+"."+F.format;M.attr("src",H),o.click(function(){$("#video-cover-"+c).show(),document.getElementById("video-"+c).play()})}else o.css({height:b,width:s})});for(var Y=0;Y<V.length;Y++){var A=$(V[Y]),F=A.attr("id"),H=F.substring(F.length-3);if("text-overlay"==A.data().type){var O=u(H)-g;0===Y&&(O-=S),A.css({"margin-left":O})}}var W=w.reduce(function(e,i){return e+i}),q=W+g+S;D.css({height:b,width:q});var G=[];for(var J in journeyConfigs.mapEl)if(journeyConfigs.mapEl.hasOwnProperty(J)){var K=journeyConfigs.mapEl[J],N=u(K.id);K.position=N,K.animationTrigger=n?N:N-e/2,K.played=!1,G.push(K)}for(var Y=0;Y<journeyConfigs.visSteps.length;Y++)journeyConfigs.visSteps[Y].position=u(journeyConfigs.visSteps[Y].id);a();var Q=!1,R=(Math.floor(q-e+g),0),U=_.throttle(function(){s(G,journeyConfigs.visSteps)},200);$("#vis").scroll(U),$("body").mousewheel(function(e){var i=$("#vis").scrollLeft();$("#vis").scrollLeft(i-e.deltaY*e.deltaFactor),e.preventDefault()}),document.onkeydown=function(i){i||(i=window.event);var t=i.keyCode;i.charCode&&0===t&&(t=i.charCode);var n=.1*e,a=$("#vis").scrollLeft();switch(t){case 37:$("#vis").scrollLeft(a-n);break;case 38:$("#vis").scrollLeft(a-n);break;case 39:$("#vis").scrollLeft(a+n);break;case 40:$("#vis").scrollLeft(a+n);break;case 33:$("#vis").scrollLeft(a-2*n);break;case 34:$("#vis").scrollLeft(a+2*n);break;case 32:$("#vis").scrollLeft(a+2*n);break;case 27:Q&&l()}i.preventDefault()},$(".steps-link").click(function(){var e=$(this),i=e.data().scroll;c(i)}),$("#menu-link").click(function(){$("#menu-cover").fadeTo(500,1),$("#menu-icon").removeClass("fa-bars").addClass("fa-times"),Q=!0}),$("#menu-icon").click(function(){Q?l():r()});for(var X=$("#menu > a"),Y=0;Y<X.length;Y++){var Z=$(X[Y]),ee=Z.attr("id");ee==="menu-"+journeyConfigs.meta.slug&&(Z.attr("href","#"),Z.addClass("disabled"),Z.find("div > h3").addClass("highlight"))}if($("#menu-back").click(function(){$("#menu-cover").fadeTo(500,0,function(){$(this).css({display:"none"})}),$("#menu-icon").removeClass("fa-times").addClass("fa-bars"),Q=!1}),$("#vis").fadeTo("slow",1,function(){var e=n?$("#begin-mobile"):$("#begin");setTimeout(function(){e.css({display:"block"})},1500)}),$(".video-wrapper").click(function(e){e.target===this&&$(this).parent().parent().hide()}),$(".modal-cover").click(function(e){e.target===this&&$(this).hide()}),initMaps(e,i,t,n,d,f,g,v,m,h,p,y,b,k),$("#vis").scrollLeft()>=W-e){var R=$("#vis").scrollLeft(),ie=R+e-W;$("#vis").scrollLeft(R-ie)}}$(document).ready(function(){calculateViewportDimensions()}),$(window).on("resize",_.debounce(function(){$("#change-orientation").hide(),$(".menu-icon-container").show(),$(".ps-scrollbar-x-rail, .ps-scrollbar-y-rail").remove(),calculateViewportDimensions()},500));