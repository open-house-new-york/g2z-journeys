"use strict";function initMaps(t,e,n,i,r,o,a,s,l,c,p,f,g,u){function h(t,n,r,o,a,l){var c=.99*$(".map-inci-coll").width(),p=e,f=d3.geo.albers().scale(1).translate([0,0]),g=d3.geo.path().projection(f),u=g.bounds(t),h=.8,d=h/Math.max((u[1][0]-u[0][0])/c,(u[1][1]-u[0][1])/p),y=[(c-d*(u[1][0]+u[0][0]))/2,(p-d*(u[1][1]+u[0][1]))/2];f.scale(d).translate(y),d3.select("#map-inci-coll-svg")&&d3.select("#map-inci-coll-svg").remove();var m=d3.select(".map-inci-coll").append("svg").attr("width",c).attr("height",p).attr("id","map-inci-coll-svg").on("click",function(t){journeyConfigs.mapEl.inciColl.startAnimation()});$("#map-inci-coll-svg").css({position:"absolute",top:-s});for(var j=(m.append("circle").attr("cx",c/2).attr("cy",p/2).attr("r",c/2).style("fill",journeyConfigs.mapConfigs.colors.background).attr("stroke-width",0),m.append("clipPath").attr("id","mapClip").append("circle").attr("cx",c/2).attr("cy",p/2).attr("r",c/2),m.append("g").attr("class","mapGroup").attr("clip-path","url(#mapClip)")),C=j.append("g").attr("class","usStates"),w=j.append("g").attr("class","commDist"),_=j.append("g").attr("class","truckLines"),x=j.append("g").attr("class","tsPoints"),k=j.append("g").attr("class","NSExport"),v=(j.append("g").attr("class","NSExportPoint"),[]),S=[],E=[],L=0;L<n.features.length;L++)"Covanta - Essex"===n.features[L].properties.disposal?v.push(n.features[L].properties.d_id):"North Shore MTS"===n.features[L].properties.disposal?S.push(n.features[L].properties.d_id):E.push(n.features[L].properties.d_id);C.selectAll(".usStates").data(o.features).enter().append("path").attr({d:g}).style("stroke","black").style("stroke-width",0).style("fill",journeyConfigs.mapConfigs.colors.land).attr("class","usStates"),w.selectAll(".nycd").data(t.features).enter().append("path").attr({d:g}).style("stroke","black").style("stroke-width",0).style("fill",function(t,e){return journeyConfigs.mapConfigs.colors.land}).attr("class","nycd"),_.selectAll(".truckLines").data(n.features).enter().append("path").attr({d:g}).style("stroke",journeyConfigs.mapConfigs.colors.wasteLines).attr("stroke-width",function(t){return 2}).style("fill","none").attr("stroke-dasharray",function(t){return this.getTotalLength()+" "+this.getTotalLength()}).attr("stroke-dashoffset",function(t){return this.getTotalLength()}).attr("class","truckLines"),k.selectAll(".NSExport").data(a.features).enter().append("path").attr({d:g}).style("stroke",journeyConfigs.mapConfigs.colors.wasteLines).attr("stroke-width",function(t){return 2}).style("fill","none").attr("stroke-dasharray",function(t){return this.getTotalLength()+" "+this.getTotalLength()}).attr("stroke-dashoffset",function(t){return this.getTotalLength()}).attr("class","NSExport"),x.selectAll(".tsPoints").data(r.features).enter().append("circle").attr("cx",function(t){return f([t.geometry.coordinates[0],t.geometry.coordinates[1]])[0]}).attr("cy",function(t){return f([t.geometry.coordinates[0],t.geometry.coordinates[1]])[1]}).attr("r",0).style("stroke","#fff").style("stroke-width",1).style("fill",journeyConfigs.mapConfigs.colors.wasteCircles).attr("class","tsPoints");var T=["Waste destination"],A=["Collection truck to incinerator","Transfer Station to incinerator","Transfer Station to landfill"],N=20,b=20,M=10,O=i?0:60,P=p/4,D=(m.selectAll("inciLegendTitle").data(T).enter().append("text").attr("class","map-legend legend-inci").attr("id","inci-legend-title").attr("x",O).attr("y",P-M).text(function(t,e){return T[e]}).attr("opacity",0),m.selectAll("inciLegend").data(journeyConfigs.mapConfigs.colors.scale).enter().append("g").attr("class","map-legend legend-inci").attr("id",function(t,e){return"inci-legend-"+e}).attr("opacity",0));D.append("circle").attr("class","legend-inci").attr("cx",O+N/2).attr("cy",function(t,e){return P+e*b+e*M+N/2}).attr("r",N/2).style("stroke","#fff").style("stroke-width",1).style("fill",function(t,e){return t}),D.append("text").attr("class","legend-inci").attr("x",O+N+M).attr("y",function(t,e){return P+e*b+13+e*M}).text(function(t,e){return A[e]}),journeyConfigs.mapEl.inciColl.animationPlayed=!1,journeyConfigs.mapEl.inciColl.startAnimation=function(){journeyConfigs.mapEl.inciColl.animationPlayed||(journeyConfigs.mapEl.inciColl.animationPlayed=!0,x.selectAll(".tsPoints").each(function(t,e){d3.select(this).attr("r",0)}),w.selectAll(".nycd").each(function(t,e){d3.select(this).style("fill",journeyConfigs.mapConfigs.colors.land).attr("opacity",1)}),k.selectAll(".NSExport").each(function(t,e){d3.select(this).style("fill","none").attr("stroke-dasharray",function(t){return this.getTotalLength()+" "+this.getTotalLength()}).attr("stroke-dashoffset",function(t){return this.getTotalLength()})}),m.selectAll(".map-legend").attr("opacity",0),_.selectAll(".truckLines").each(function(t,e){d3.select(this).filter(function(t){return"Covanta - Essex"===t.properties.disposal}).attr("stroke-dashoffset",function(t){return this.getTotalLength()}).transition().duration(1500).attr("stroke-dashoffset",0).each("end",function(){journeyConfigs.mapEl.inciColl.covantaCircle()})}))},journeyConfigs.mapEl.inciColl.covantaCircle=function(){x.selectAll(".tsPoints").each(function(t,e){d3.select(this).filter(function(t){return"Covanta - Essex"===t.properties.disposal}).attr("r",0).transition().duration(1500).attr("r",function(t){return journeyConfigs.mapConfigs.scales.circleRadius(t.properties.j_tot_rec)}).each("end",function(){journeyConfigs.mapEl.inciColl.covantaLinesOut()})})},journeyConfigs.mapEl.inciColl.covantaLinesOut=function(){m.selectAll("text-covanta").data(r.features).enter().append("text").filter(function(t){return"Covanta - Essex"===t.properties.disposal}).attr("x",function(t){return f([t.geometry.coordinates[0],t.geometry.coordinates[1]])[0]}).attr("y",function(t){return f([t.geometry.coordinates[0],t.geometry.coordinates[1]])[1]}).attr("transform",function(t){var e=i?-8:-20;return"translate("+e+",0)"}).attr("class","covanta-legend map-legend").attr("text-anchor","end").text("Waste incinerator"),m.selectAll("text-covanta-below").data(r.features).enter().append("text").filter(function(t){return"Covanta - Essex"===t.properties.disposal}).attr("x",function(t){return f([t.geometry.coordinates[0],t.geometry.coordinates[1]])[0]}).attr("y",function(t){return f([t.geometry.coordinates[0],t.geometry.coordinates[1]])[1]}).attr("transform",function(t){var e=i?-8:-20;return"translate("+e+",15)"}).attr("class","covanta-legend map-legend").attr("text-anchor","end").text("Newark, NJ"),w.selectAll(".nycd").each(function(t,e){d3.select(this).filter(function(t){var e=null!==t.properties.BoroCD?t.properties.BoroCD.toString():"na",n=$.inArray(e,v)>=0;return!!n}).transition().duration(1500).style("fill",journeyConfigs.mapConfigs.colors.wasteCircles).attr("opacity",1)}),_.selectAll(".truckLines").each(function(t,e){d3.select(this).filter(function(t){return"Covanta - Essex"===t.properties.disposal}).attr("stroke-dashoffset",0).transition().duration(1500).attr("stroke-dashoffset",function(t){return-this.getTotalLength()}).each("end",function(){journeyConfigs.mapEl.inciColl.NSMTSLinesIn()})})},journeyConfigs.mapEl.inciColl.NSMTSLinesIn=function(){_.selectAll(".truckLines").each(function(t,e){d3.select(this).filter(function(t){return"North Shore MTS"===t.properties.disposal}).attr("stroke-dashoffset",function(t){return this.getTotalLength()}).style("stroke",journeyConfigs.mapConfigs.colors.wasteOpacity).transition().duration(1500).attr("stroke-dashoffset",0).each("end",function(){journeyConfigs.mapEl.inciColl.NSMTSCircle()})})},journeyConfigs.mapEl.inciColl.NSMTSCircle=function(){x.selectAll(".tsPoints").each(function(t,e){d3.select(this).filter(function(t){return"North Shore MTS"===t.properties.disposal}).attr("r",0).style("fill",journeyConfigs.mapConfigs.colors.wasteOpacity).transition().duration(1500).attr("r",function(t){return journeyConfigs.mapConfigs.scales.circleRadius(t.properties.j_tot_rec)}).each("end",function(){journeyConfigs.mapEl.inciColl.NSMTSLinesOut()})})},journeyConfigs.mapEl.inciColl.NSMTSLinesOut=function(){m.selectAll("text-covanta").data(r.features).enter().append("text").filter(function(t){return"North Shore MTS"===t.properties.disposal}).attr("x",function(t){return f([t.geometry.coordinates[0],t.geometry.coordinates[1]])[0]}).attr("y",function(t){return f([t.geometry.coordinates[0],t.geometry.coordinates[1]])[1]}).attr("transform",function(t){return"translate(20,0)"}).attr("class","covanta-legend map-legend").text("North Shore MTS"),m.selectAll("text-covanta-below").data(r.features).enter().append("text").filter(function(t){return"North Shore MTS"===t.properties.disposal}).attr("x",function(t){return f([t.geometry.coordinates[0],t.geometry.coordinates[1]])[0]}).attr("y",function(t){return f([t.geometry.coordinates[0],t.geometry.coordinates[1]])[1]}).attr("transform",function(t){return"translate(20,15)"}).attr("class","covanta-legend map-legend").text("Queens"),w.selectAll(".nycd").each(function(t,e){d3.select(this).filter(function(t){var e=null!==t.properties.BoroCD?t.properties.BoroCD.toString():"na",n=$.inArray(e,S)>=0;return!!n}).transition().duration(1500).style("fill",journeyConfigs.mapConfigs.colors.wasteOpacity).attr("opacity",1)}),_.selectAll(".truckLines").each(function(t,e){d3.select(this).filter(function(t){return"North Shore MTS"===t.properties.disposal}).attr("stroke-dashoffset",0).style("fill",journeyConfigs.mapConfigs.colors.wasteOpacity).transition().duration(1500).attr("stroke-dashoffset",function(t){return-this.getTotalLength()}).each("end",function(){journeyConfigs.mapEl.inciColl.NSExportLinesIn()})})},journeyConfigs.mapEl.inciColl.NSExportLinesIn=function(){k.selectAll(".NSExport").each(function(t,e){d3.select(this).filter(function(t){return 0!==t.properties.id&&2!==t.properties.id}).attr("stroke-dashoffset",function(t){return this.getTotalLength()}).style("stroke",journeyConfigs.mapConfigs.colors.wasteOpacity).transition().duration(1500).attr("stroke-dashoffset",0).each("end",function(){journeyConfigs.mapEl.inciColl.out()})})},journeyConfigs.mapEl.inciColl.otherLinesIn=function(){_.selectAll(".truckLines").each(function(t,e){d3.select(this).filter(function(t){return"Covanta - Essex"!==t.properties.disposal&&"North Shore MTS"!==t.properties.disposal}).attr("stroke-dashoffset",function(t){return this.getTotalLength()}).style("stroke",journeyConfigs.mapConfigs.colors.complementaryOpacity).transition().duration(1500).attr("stroke-dashoffset",0).each("end",function(){journeyConfigs.mapEl.inciColl.otherCircles()})})},journeyConfigs.mapEl.inciColl.otherCircles=function(){x.selectAll(".tsPoints").each(function(t,e){d3.select(this).filter(function(t){return"Covanta - Essex"!==t.properties.disposal&&"North Shore MTS"!==t.properties.disposal}).attr("r",0).style("fill",journeyConfigs.mapConfigs.colors.complementaryOpacity).transition().duration(1500).attr("r",function(t){return journeyConfigs.mapConfigs.scales.circleRadius(t.properties.j_tot_rec)}).each("end",function(){journeyConfigs.mapEl.inciColl.otherLinesOut()})})},journeyConfigs.mapEl.inciColl.otherLinesOut=function(){w.selectAll(".nycd").each(function(t,e){d3.select(this).filter(function(t){var e=null!==t.properties.BoroCD?t.properties.BoroCD.toString():"na",n=$.inArray(e,E)>=0;return!!n}).transition().duration(1500).style("fill",journeyConfigs.mapConfigs.colors.complementaryOpacity).attr("opacity",1)}),_.selectAll(".truckLines").each(function(t,e){d3.select(this).filter(function(t){return"Covanta - Essex"!==t.properties.disposal&&"North Shore MTS"!==t.properties.disposal}).attr("stroke-dashoffset",0).transition().duration(1500).attr("stroke-dashoffset",function(t){return-this.getTotalLength()}).each("end",function(){journeyConfigs.mapEl.inciColl.NSMTSLinesIn()})})},journeyConfigs.mapEl.inciColl.out=function(){m.selectAll("text-export-points-above").data(l.features).enter().append("text").attr("x",function(t){return f([t.geometry.coordinates[0],t.geometry.coordinates[1]])[0]}).attr("y",function(t){return f([t.geometry.coordinates[0],t.geometry.coordinates[1]])[1]}).attr("transform",function(t,e){var n=0==e?-15:0;return"translate(10,"+n+")"}).attr("class","export-legend map-legend").text(function(t,e){return"To incinerator in"}),m.selectAll("text-export-points").data(l.features).enter().append("text").attr("x",function(t){return f([t.geometry.coordinates[0],t.geometry.coordinates[1]])[0]}).attr("y",function(t){return f([t.geometry.coordinates[0],t.geometry.coordinates[1]])[1]}).attr("transform",function(t,e){var n=0==e?0:15;return"translate(10,"+n+")"}).attr("class","export-legend map-legend").text(function(t,e){return t.properties.route}),setTimeout(function(){journeyConfigs.mapEl.inciColl.animationPlayed=!1},1600)}}var d=i?1:1.5;journeyConfigs.mapConfigs.colors={background:"#edf0ff",land:"#d9d9d9",wasteLines:"#f15a29",wasteCircles:"#f15a29",wasteOpacity:"#e3a793",complementary:"#1485CC",complementaryOpacity:"#8bb8d5",scale:["#f15a29","#e3a793","#8bb8d5"],scaleDropOff:["#f15a29","#1485CC"]},journeyConfigs.mapConfigs.scales={circleRadius:function(t){return.025*Math.sqrt(t/3.14)*d},lineWidth:function(t){return journeyConfigs.mapConfigs.scales.circleRadius(t)*d}},d3.json(journeyConfigs.mapDataPath,function(t){var e=t.nycd_bcd,n=t.ny_nj_ct_refined,i=t.od_lines_refuse,r=t.north_shore_export,o=t.north_shore_export_point,a=t.dest_points_refuse;h(e,i,a,n,r,o)})}var visImageSizes=[{height:600,width:1595,type:"jpg",filename:"600_ash-compacting.jpg"},{height:600,width:1133,type:"jpg",filename:"600_ash-landfill-l.jpg"},{height:600,width:1597,type:"jpg",filename:"600_ash-landfill-r.jpg"},{height:600,width:2738,type:"jpg",filename:"600_ash-landfill.jpg"},{height:600,width:1113,type:"jpg",filename:"600_ash-tipping.jpg"},{height:600,width:1163,type:"jpg",filename:"600_ash-treadmill.jpg"},{height:600,width:779,type:"jpg",filename:"600_ash-truck.jpg"},{height:600,width:873,type:"jpg",filename:"600_boiler-window-frame.jpg"},{height:600,width:1019,type:"jpg",filename:"600_boiler-window.jpg"},{height:600,width:1028,type:"jpg",filename:"600_boiler.jpg"},{height:600,width:2014,type:"jpg",filename:"600_collection.jpg"},{height:600,width:1002,type:"jpg",filename:"600_control-room.jpg"},{height:600,width:2312,type:"jpg",filename:"600_covanta-composite.jpg"},{height:600,width:984,type:"jpg",filename:"600_covanta-entrance.jpg"},{height:600,width:938,type:"jpg",filename:"600_covanta-pit-cut.jpg"},{height:600,width:938,type:"jpg",filename:"600_covanta-pit.jpg"},{height:600,width:963,type:"jpg",filename:"600_covanta-tipping.jpg"},{height:600,width:562,type:"jpg",filename:"600_diagram.jpg"},{height:600,width:896,type:"jpg",filename:"600_generator.jpg"},{height:600,width:940,type:"jpg",filename:"600_incinerator-protest.jpg"},{height:600,width:1354,type:"jpg",filename:"600_metals-sorter.jpg"},{height:600,width:208,type:"jpg",filename:"600_trash-bags.jpg"},{height:800,width:2127,type:"jpg",filename:"800_ash-compacting.jpg"},{height:800,width:1510,type:"jpg",filename:"800_ash-landfill-l.jpg"},{height:800,width:2129,type:"jpg",filename:"800_ash-landfill-r.jpg"},{height:800,width:3651,type:"jpg",filename:"800_ash-landfill.jpg"},{height:800,width:1484,type:"jpg",filename:"800_ash-tipping.jpg"},{height:800,width:1550,type:"jpg",filename:"800_ash-treadmill.jpg"},{height:800,width:1039,type:"jpg",filename:"800_ash-truck.jpg"},{height:800,width:1164,type:"jpg",filename:"800_boiler-window-frame.jpg"},{height:800,width:1359,type:"jpg",filename:"800_boiler-window.jpg"},{height:800,width:1371,type:"jpg",filename:"800_boiler.jpg"},{height:800,width:2685,type:"jpg",filename:"800_collection.jpg"},{height:800,width:1336,type:"jpg",filename:"800_control-room.jpg"},{height:800,width:3083,type:"jpg",filename:"800_covanta-composite.jpg"},{height:800,width:1312,type:"jpg",filename:"800_covanta-entrance.jpg"},{height:800,width:1251,type:"jpg",filename:"800_covanta-pit-cut.jpg"},{height:800,width:1251,type:"jpg",filename:"800_covanta-pit.jpg"},{height:800,width:1284,type:"jpg",filename:"800_covanta-tipping.jpg"},{height:800,width:749,type:"jpg",filename:"800_diagram.jpg"},{height:800,width:1195,type:"jpg",filename:"800_generator.jpg"},{height:690,width:1081,type:"jpg",filename:"800_incinerator-protest.jpg"},{height:800,width:1805,type:"jpg",filename:"800_metals-sorter.jpg"},{height:800,width:277,type:"jpg",filename:"800_trash-bags.jpg"}],journeyConfigs={};journeyConfigs.meta={name:"Incineration",slug:"incineration",id:1},journeyConfigs.firstPanelId="panel-0-1",journeyConfigs.mapEl={inciColl:{id:"2-1"}},journeyConfigs.mapDataPath="data/incineration.geojson",journeyConfigs.mapConfigs={};