"use strict";function initMaps(t,e,n,a,i,p,s,l,o,r,g,h,f,c){function d(t,n,a){for(var i=.99*$(".map-export").width(),p=e,s=d3.geo.mercator().scale(1).translate([0,0]),o=d3.geo.path().projection(s),r=t.features.length;r--;)"Landfill"!==t.features[r].properties.sent_fac_t&&t.features.splice(r,1);for(var g=n.features.length;g--;)null===n.features[g].geometry.coordinates&&n.features.splice(g,1);var h=o.bounds(t),f=.75,c=f/Math.max((h[1][0]-h[0][0])/i,(h[1][1]-h[0][1])/p),d=[(i-c*(h[1][0]+h[0][0]))/2,(p-c*(h[1][1]+h[0][1]))/2];s.scale(c).translate(d),d3.select("#map-export-svg")&&d3.select("#map-export-svg").remove();var y=d3.select(".map-export").append("svg").attr("width",i).attr("height",p).attr("id","map-export-svg").on("click",function(t){journeyConfigs.mapEl.wasteExport.startAnimation()});$("#map-export-svg").css({position:"absolute",top:-l});var j=(y.append("circle").attr("cx",i/2).attr("cy",p/2).attr("r",i/2).attr("fill",journeyConfigs.mapConfigs.colors.background).attr("stroke-width",0),y.append("clipPath").attr("id","mapClip").append("circle").attr("cx",i/2).attr("cy",p/2).attr("r",i/2),y.append("g").attr("class","mapGroup").attr("clip-path","url(#mapClip)")),u=j.append("g").attr("class","usStates"),m=j.append("g").attr("class","lineConnect"),w=j.append("g").attr("class","exportPoints");u.selectAll(".usStates").data(a.features).enter().append("path").attr({d:o}).style("stroke","#fff").style("stroke-width",1).style("fill",journeyConfigs.mapConfigs.colors.land),m.selectAll(".lineConnect").data(t.features).enter().append("path").attr({d:o,"stroke-dasharray":"0 5000"}).style("stroke",journeyConfigs.mapConfigs.colors.wasteLines).attr("stroke-width",function(t){return"Landfill"===t.properties.sent_fac_t?journeyConfigs.mapConfigs.scales.lineWidth(t.properties.sent_tons_):0}).style("fill","none").attr("stroke-dasharray",function(t){return this.getTotalLength()+" "+this.getTotalLength()}).attr("stroke-dashoffset",function(t){return-this.getTotalLength()}).attr("class","lineConnect"),w.selectAll(".exportPoints").data(n.features).enter().append("circle").attr("cx",function(t){return s([t.geometry.coordinates[0],t.geometry.coordinates[1]])[0]}).attr("cy",function(t){return s([t.geometry.coordinates[0],t.geometry.coordinates[1]])[1]}).attr("r",0).style("stroke","#fff").style("stroke-width",1).style("fill",journeyConfigs.mapConfigs.colors.wasteCircles).attr("opacity",function(t){return"Landfill"===t.properties.sent_fac_t?1:0}).attr("class","exportPoints"),journeyConfigs.mapEl.wasteExport.animationPlayed=!1,journeyConfigs.mapEl.wasteExport.startAnimation=function(){journeyConfigs.mapEl.wasteExport.animationPlayed||(journeyConfigs.mapEl.wasteExport.animationPlayed=!0,w.selectAll(".exportPoints").each(function(t,e){d3.select(this).attr("r",0)}),m.selectAll(".lineConnect").each(function(t,e){d3.select(this).attr("stroke-dasharray",function(t){return this.getTotalLength()+" "+this.getTotalLength()}).attr("stroke-dashoffset",function(t){return-this.getTotalLength()}).attr("class","lineConnect").transition().duration(1500).attr("stroke-dashoffset",0).each("end",function(){journeyConfigs.mapEl.wasteExport.transitionCircles()})}))},journeyConfigs.mapEl.wasteExport.transitionCircles=function(){w.selectAll(".exportPoints").each(function(t,e){d3.select(this).attr("r",0).transition().duration(1500).attr("r",function(t){return journeyConfigs.mapConfigs.scales.circleRadius(t.properties.sent_tons_)}).each("end",function(){journeyConfigs.mapEl.wasteExport.linesOut()})})},journeyConfigs.mapEl.wasteExport.linesOut=function(){m.selectAll(".lineConnect").each(function(t,e){d3.select(this).attr("stroke-dasharray",function(t){return this.getTotalLength()+" "+this.getTotalLength()}).attr("stroke-dashoffset",0).attr("class","lineConnect").transition().duration(1500).attr("stroke-dashoffset",function(t){return this.getTotalLength()})}),setTimeout(function(){journeyConfigs.mapEl.wasteExport.animationPlayed=!1},1600)}}function y(t,n,i,p){var s=.99*$(".map-nyc").width(),o=e,r=d3.geo.albers().scale(1).translate([0,0]),g=d3.geo.path().projection(r),h=g.bounds(t),f=a?.75:.95,c=f/Math.max((h[1][0]-h[0][0])/s,(h[1][1]-h[0][1])/o),d=[(s-c*(h[1][0]+h[0][0]))/2,(o-c*(h[1][1]+h[0][1]))/2];r.scale(c).translate(d),d3.select("#map-nyc-svg")&&d3.select("#map-nyc-svg").remove();var y=d3.select(".map-nyc").append("svg").attr("width",s).attr("height",o).attr("id","map-nyc-svg").on("click",function(t){journeyConfigs.mapEl.nyc.startAnimation()});$("#map-nyc-svg").css({position:"absolute",top:-l});var j=(y.append("circle").attr("cx",s/2).attr("cy",o/2).attr("r",s/2).attr("fill",journeyConfigs.mapConfigs.colors.background).attr("stroke-width",0),y.append("clipPath").attr("id","mapClip").append("circle").attr("cx",s/2).attr("cy",o/2).attr("r",s/2),y.append("g").attr("class","mapGroup").attr("clip-path","url(#mapClip)")),u=j.append("g").attr("class","usStates"),m=j.append("g").attr("class","commDist"),w=j.append("g").attr("class","lineConnect"),C=j.append("g").attr("class","destPointsRefuse");u.selectAll(".usStates").data(p.features).enter().append("path").attr({d:g}).style("stroke","black").style("stroke-width",0).style("fill",journeyConfigs.mapConfigs.colors.land).attr("class","usStates"),m.selectAll(".nycd").data(i.features).enter().append("path").attr({d:g}).style("stroke","black").style("stroke-width",0).style("fill",journeyConfigs.mapConfigs.colors.land).attr("class","nycd"),w.selectAll(".lineConnect").data(t.features).enter().append("path").attr({d:g}).style("stroke",journeyConfigs.mapConfigs.colors.wasteLines).attr("stroke-width",function(t){return journeyConfigs.mapConfigs.scales.lineWidth(t.properties.j_tot_rec)}).style("fill","none").attr("stroke-dasharray",function(t){return this.getTotalLength()+" "+this.getTotalLength()}).attr("stroke-dashoffset",function(t){return this.getTotalLength()}).attr("class","lineConnect"),C.selectAll(".destPointsRefuse").data(n.features).enter().append("circle").attr("cx",function(t){return r([t.geometry.coordinates[0],t.geometry.coordinates[1]])[0]}).attr("cy",function(t){return r([t.geometry.coordinates[0],t.geometry.coordinates[1]])[1]}).attr("r",0).style("stroke","#fff").style("stroke-width",1).style("fill",journeyConfigs.mapConfigs.colors.wasteCircles).attr("class","destPointsRefuse"),journeyConfigs.mapEl.nyc.animationPlayed=!1,journeyConfigs.mapEl.nyc.startAnimation=function(){journeyConfigs.mapEl.nyc.animationPlayed||(journeyConfigs.mapEl.nyc.animationPlayed=!0,C.selectAll(".destPointsRefuse").each(function(t,e){d3.select(this).attr("r",0)}),w.selectAll(".lineConnect").each(function(t,e){d3.select(this).attr("stroke-dasharray",function(t){return this.getTotalLength()+" "+this.getTotalLength()}).attr("stroke-dashoffset",function(t){return this.getTotalLength()}).attr("class","lineConnect").transition().duration(1500).attr("stroke-dashoffset",0).each("end",function(){journeyConfigs.mapEl.nyc.transitionCircles()})}))},journeyConfigs.mapEl.nyc.transitionCircles=function(){C.selectAll(".destPointsRefuse").each(function(t,e){d3.select(this).attr("r",0).transition().duration(1500).attr("r",function(t){return journeyConfigs.mapConfigs.scales.circleRadius(t.properties.j_tot_rec)}).each("end",function(){journeyConfigs.mapEl.nyc.linesOut()})})},journeyConfigs.mapEl.nyc.linesOut=function(){w.selectAll(".lineConnect").each(function(t,e){d3.select(this).attr("stroke-dasharray",function(t){return this.getTotalLength()+" "+this.getTotalLength()}).attr("stroke-dashoffset",0).attr("class","lineConnect").transition().duration(1500).attr("stroke-dashoffset",function(t){return-this.getTotalLength()})}),setTimeout(function(){journeyConfigs.mapEl.nyc.animationPlayed=!1},1600)}}journeyConfigs.mapConfigs.colors={background:"#edf0ff",land:"#d9d9d9",wasteLines:"#f15a29",wasteCircles:"#f15a29"},journeyConfigs.mapConfigs.scales={circleRadius:function(t){return.025*Math.sqrt(t/3.14)},lineWidth:function(t){return journeyConfigs.mapConfigs.scales.circleRadius(t)/2}},d3.json(journeyConfigs.mapDataPath,function(t){var e=t.od_lines_refuse,n=t.dest_points_refuse,a=t.nycd,i=t.dest_lines,p=t.export_points,s=t.states_east,l=t.ny_nj_ct;y(e,n,a,l),d(i,p,s)})}var visImageSizes=[{height:500,width:251,type:"jpg",filename:"500_panel-0-1.jpg"},{height:500,width:399,type:"jpg",filename:"500_panel-1-1.jpg"},{height:500,width:1431,type:"jpg",filename:"500_panel-1-2.jpg"},{height:500,width:1543,type:"jpg",filename:"500_panel-2-3.jpg"},{height:500,width:1497,type:"jpg",filename:"500_panel-2-4.jpg"},{height:500,width:1394,type:"jpg",filename:"500_panel-2-5.jpg"},{height:500,width:2813,type:"jpg",filename:"500_panel-2-7.jpg"},{height:500,width:654,type:"jpg",filename:"500_panel-3-1.jpg"},{height:500,width:441,type:"jpg",filename:"500_panel-3-2.jpg"},{height:500,width:1122,type:"jpg",filename:"500_panel-3-3.jpg"},{height:500,width:818,type:"jpg",filename:"500_panel-4-1.jpg"},{height:500,width:993,type:"jpg",filename:"500_panel-4-3.jpg"},{height:500,width:523,type:"jpg",filename:"500_panel-4-4.jpg"},{height:500,width:913,type:"jpg",filename:"500_panel-4-5.jpg"},{height:500,width:788,type:"jpg",filename:"500_panel-4-6-2.jpg"},{height:500,width:788,type:"jpg",filename:"500_panel-4-6.jpg"},{height:600,width:300,type:"jpg",filename:"600_panel-0-1.jpg"},{height:600,width:479,type:"jpg",filename:"600_panel-1-1.jpg"},{height:600,width:1716,type:"jpg",filename:"600_panel-1-2.jpg"},{height:600,width:1850,type:"jpg",filename:"600_panel-2-3.jpg"},{height:600,width:1796,type:"jpg",filename:"600_panel-2-4.jpg"},{height:600,width:1663,type:"jpg",filename:"600_panel-2-5.jpg"},{height:600,width:3376,type:"jpg",filename:"600_panel-2-7.jpg"},{height:600,width:771,type:"jpg",filename:"600_panel-3-1.jpg"},{height:600,width:529,type:"jpg",filename:"600_panel-3-2.jpg"},{height:600,width:1346,type:"jpg",filename:"600_panel-3-3.jpg"},{height:600,width:981,type:"jpg",filename:"600_panel-4-1.jpg"},{height:600,width:1191,type:"jpg",filename:"600_panel-4-3.jpg"},{height:600,width:627,type:"jpg",filename:"600_panel-4-4.jpg"},{height:600,width:1095,type:"jpg",filename:"600_panel-4-5.jpg"},{height:600,width:945,type:"jpg",filename:"600_panel-4-6-2.jpg"},{height:600,width:945,type:"jpg",filename:"600_panel-4-6.jpg"},{height:700,width:351,type:"jpg",filename:"700_panel-0-1.jpg"},{height:700,width:559,type:"jpg",filename:"700_panel-1-1.jpg"},{height:700,width:2003,type:"jpg",filename:"700_panel-1-2.jpg"},{height:700,width:2159,type:"jpg",filename:"700_panel-2-3.jpg"},{height:700,width:2095,type:"jpg",filename:"700_panel-2-4.jpg"},{height:700,width:1952,type:"jpg",filename:"700_panel-2-5.jpg"},{height:700,width:3939,type:"jpg",filename:"700_panel-2-7.jpg"},{height:700,width:916,type:"jpg",filename:"700_panel-3-1.jpg"},{height:700,width:617,type:"jpg",filename:"700_panel-3-2.jpg"},{height:700,width:1570,type:"jpg",filename:"700_panel-3-3.jpg"},{height:700,width:1145,type:"jpg",filename:"700_panel-4-1.jpg"},{height:700,width:1390,type:"jpg",filename:"700_panel-4-3.jpg"},{height:700,width:732,type:"jpg",filename:"700_panel-4-4.jpg"},{height:700,width:1278,type:"jpg",filename:"700_panel-4-5.jpg"},{height:700,width:1103,type:"jpg",filename:"700_panel-4-6-2.jpg"},{height:700,width:1102,type:"jpg",filename:"700_panel-4-6.jpg"},{height:800,width:401,type:"jpg",filename:"800_panel-0-1.jpg"},{height:800,width:639,type:"jpg",filename:"800_panel-1-1.jpg"},{height:800,width:2288,type:"jpg",filename:"800_panel-1-2.jpg"},{height:800,width:2467,type:"jpg",filename:"800_panel-2-3.jpg"},{height:800,width:2395,type:"jpg",filename:"800_panel-2-4.jpg"},{height:800,width:2218,type:"jpg",filename:"800_panel-2-5.jpg"},{height:800,width:1028,type:"jpg",filename:"800_panel-3-1.jpg"},{height:800,width:705,type:"jpg",filename:"800_panel-3-2.jpg"},{height:800,width:1794,type:"jpg",filename:"800_panel-3-3.jpg"},{height:800,width:1308,type:"jpg",filename:"800_panel-4-1.jpg"},{height:800,width:1588,type:"jpg",filename:"800_panel-4-3.jpg"},{height:800,width:837,type:"jpg",filename:"800_panel-4-4.jpg"},{height:800,width:1461,type:"jpg",filename:"800_panel-4-5.jpg"},{height:800,width:1260,type:"jpg",filename:"800_panel-4-6-2.jpg"},{height:800,width:1259,type:"jpg",filename:"800_panel-4-6.jpg"}],journeyConfigs={};journeyConfigs.meta={name:"From Curb to Lanfill",slug:"curb-to-landfill",id:1},journeyConfigs.firstPanelId="panel-0-1",journeyConfigs.visSteps=[{step:1,name:"Collection",id:"1-1"},{step:2,name:"Transfer",id:"2-1"},{step:3,name:"Export",id:"3-1"},{step:4,name:"Disposal",id:"4-1"}],journeyConfigs.mapEl={nyc:{id:"1-4"},wasteExport:{id:"3-4"}},journeyConfigs.mapDataPath="data/curb-to-landfill.geojson",journeyConfigs.mapConfigs={};