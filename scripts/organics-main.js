"use strict";function initMaps(t,e,n,a,o,r,i,s,l,c,p,g,d,f){function u(t,n){var o=.99*$(".map-organics-coll").width(),r=e,i=d3.geo.albers().scale(1).translate([0,0]),l=d3.geo.path().projection(i),c=l.bounds(t),p=.8,g=p/Math.max((c[1][0]-c[0][0])/o,(c[1][1]-c[0][1])/r),d=[(o-g*(c[1][0]+c[0][0]))/2,(r-g*(c[1][1]+c[0][1]))/2];i.scale(g).translate(d),d3.select("#map-organics-coll-svg")&&d3.select("#map-organics-coll-svg").remove();var f=d3.select(".map-organics-coll").append("svg").attr("width",o).attr("height",r).attr("id","map-organics-coll-svg").on("click",function(t){journeyConfigs.mapEl.organicsColl.startAnimation()});$("#map-organics-coll-svg").css({position:"absolute",top:-s});var u=(f.append("circle").attr("cx",o/2).attr("cy",r/2).attr("r",o/2).style("fill",journeyConfigs.mapConfigs.colors.background).attr("stroke-width",0),f.append("clipPath").attr("id","mapClip").append("circle").attr("cx",o/2).attr("cy",r/2).attr("r",o/2),f.append("g").attr("class","mapGroup").attr("clip-path","url(#mapClip)")),y=u.append("g").attr("class","usStates"),m=u.append("g").attr("class","commDist");y.selectAll(".usStates").data(n.features).enter().append("path").attr({d:l}).style("stroke","black").style("stroke-width",0).style("fill",journeyConfigs.mapConfigs.colors.land).attr("class","usStates"),m.selectAll(".nycd").data(t.features).enter().append("path").attr({d:l}).style("stroke","black").style("stroke-width",0).style("fill",function(t,e){return journeyConfigs.mapConfigs.colors.land}).attr("class","nycd");var h=["Residential organics collection"],C=["Has curbside collection","Coming in 2017","Coming in 2018","Buildings can enroll"],j=20,w=20,b=10,E=a?0:60,x=r/4,_=(f.selectAll("organicsLegendTitle").data(h).enter().append("text").attr("class","map-legend legend-organics").attr("id","organics-legend-title").attr("x",E).attr("y",x-b).text(function(t,e){return h[e]}).attr("opacity",0),f.selectAll("organicsLegend").data(journeyConfigs.mapConfigs.colors.scale).enter().append("g").attr("class","map-legend legend-organics").attr("id",function(t,e){return"organics-legend-"+e}).attr("opacity",0));_.append("rect").attr("class","legend-organics").attr("x",E).attr("y",function(t,e){return x+e*w+e*b}).attr("width",j).attr("height",w).style("fill",function(t,e){return t}),_.append("text").attr("class","legend-organics").attr("x",E+j+b).attr("y",function(t,e){return x+e*w+13+e*b}).text(function(t,e){return C[e]}),journeyConfigs.mapEl.organicsColl.animationPlayed=!1,journeyConfigs.mapEl.organicsColl.startAnimation=function(){journeyConfigs.mapEl.organicsColl.animationPlayed||(journeyConfigs.mapEl.organicsColl.animationPlayed=!0,m.selectAll(".nycd").each(function(t,e){d3.select(this).style("fill",journeyConfigs.mapConfigs.colors.land)}),f.selectAll(".map-legend").attr("opacity",0),d3.select("#organics-legend-title").attr("opacity",1),d3.select("#organics-legend-0").attr("opacity",1),m.selectAll(".nycd").each(function(t,e){d3.select(this).filter(function(t){return"existing"===t.properties.upcoming}).transition().duration(1500).style("fill",function(t){return journeyConfigs.mapConfigs.colors.scale[0]}).each("end",function(){d3.select("#organics-legend-1").attr("opacity",1),journeyConfigs.mapEl.organicsColl.thisYear()})}))},journeyConfigs.mapEl.organicsColl.thisYear=function(){m.selectAll(".nycd").each(function(t,e){d3.select(this).filter(function(t){return"2017"==t.properties.upcoming}).transition().duration(1500).style("fill",function(t){return journeyConfigs.mapConfigs.colors.scale[1]}).each("end",function(){d3.select("#organics-legend-2").attr("opacity",1),journeyConfigs.mapEl.organicsColl.nextYear()})})},journeyConfigs.mapEl.organicsColl.nextYear=function(){m.selectAll(".nycd").each(function(t,e){d3.select(this).filter(function(t){return"2018"==t.properties.upcoming}).transition().duration(1500).style("fill",function(t){return journeyConfigs.mapConfigs.colors.scale[2]}).each("end",function(){d3.select("#organics-legend-3").attr("opacity",1),journeyConfigs.mapEl.organicsColl.bldg()})})},journeyConfigs.mapEl.organicsColl.bldg=function(){m.selectAll(".nycd").each(function(t,e){d3.select(this).filter(function(t){return"bldg"===t.properties.upcoming}).transition().duration(1500).style("fill",function(t){return journeyConfigs.mapConfigs.colors.scale[3]}).each("end",function(){journeyConfigs.mapEl.organicsColl.out()})})},journeyConfigs.mapEl.organicsColl.out=function(){setTimeout(function(){journeyConfigs.mapEl.organicsColl.animationPlayed=!1},1600)}}function y(t,n,o){var r=.99*$(".map-organicsdest").width(),i=e,l=d3.geo.albers().scale(1).translate([0,0]),c=d3.geo.path().projection(l),p=c.bounds(n),g=.75,d=g/Math.max((p[1][0]-p[0][0])/r,(p[1][1]-p[0][1])/i),f=[(r-d*(p[1][0]+p[0][0]))/2,(i-d*(p[1][1]+p[0][1]))/2];l.scale(d).translate(f),d3.select("#map-organicsdest-svg")&&d3.select("#map-organicsdest-svg").remove();var u=d3.select(".map-organicsdest").append("svg").attr("width",r).attr("height",i).attr("id","map-organicsdest-svg").on("click",function(t){journeyConfigs.mapEl.organicsDest.startAnimation()});$("#map-organicsdest-svg").css({position:"absolute",top:-s});var y=(u.append("circle").attr("cx",r/2).attr("cy",i/2).attr("r",r/2).style("fill",journeyConfigs.mapConfigs.colors.background).attr("stroke-width",0),u.append("clipPath").attr("id","mapClip").append("circle").attr("cx",r/2).attr("cy",i/2).attr("r",r/2),u.append("g").attr("class","mapGroup").attr("clip-path","url(#mapClip)")),m=y.append("g").attr("class","usStates"),h=y.append("g").attr("class","commDist"),C=y.append("g").attr("class","organicsDestSites");m.selectAll(".usStates").data(o.features).enter().append("path").attr({d:c}).style("stroke","#fff").style("stroke-width",.8).style("fill",journeyConfigs.mapConfigs.colors.land).attr("class","usStates"),h.selectAll(".nycd").data(t.features).enter().append("path").attr({d:c}).style("stroke","black").style("stroke-width",0).style("fill",function(t,e){return journeyConfigs.mapConfigs.colors.land}).attr("class","nycd"),C.selectAll(".organicsDestSites").data(n.features).enter().append("circle").attr("cx",function(t){return l([t.geometry.coordinates[0],t.geometry.coordinates[1]])[0]}).attr("cy",function(t){return l([t.geometry.coordinates[0],t.geometry.coordinates[1]])[1]}).attr("r",0).style("stroke","#fff").style("stroke-width",1).style("fill",function(t,e){return"compost"===t.properties.type?journeyConfigs.mapConfigs.colors.wasteCircles:journeyConfigs.mapConfigs.colors.complementary}).attr("class","organicsDestSites");var j=["Composting facility","Anaerobic digester"],w=20,b=20,E=10,x=a?0:60,_=i/2,A=["#f15a29","#1485CC"],k=u.selectAll("destinationLegend").data(A).enter().append("g").attr("class","map-legend legend-destination").attr("id",function(t,e){return"destination-legend-"+e}).attr("opacity",0);k.append("rect").attr("class","legend-destination").attr("x",x).attr("y",function(t,e){return _+e*b+e*E}).attr("width",w).attr("height",b).style("fill",function(t,e){return t}),k.append("text").attr("class","legend-destination").attr("x",x+w+E).attr("y",function(t,e){return _+e*b+13+e*E}).text(function(t,e){return j[e]}),journeyConfigs.mapEl.organicsDest.animationPlayed=!1,journeyConfigs.mapEl.organicsDest.zoom=!1,journeyConfigs.mapEl.organicsDest.initial=!1,journeyConfigs.mapEl.organicsDest.startAnimation=function(){journeyConfigs.mapEl.organicsDest.animationPlayed||(journeyConfigs.mapEl.organicsDest.animationPlayed=!0,C.selectAll(".organicsDestSites").each(function(t,e){d3.select(this).attr("r",0)}),u.selectAll(".map-legend").attr("opacity",0),u.selectAll(".legend-destination").attr("opacity",0),C.selectAll(".organicsDestSites").each(function(t,e){d3.select(this).transition().duration(1500).attr("r",function(t,e){return a?3:5}).each("end",function(){journeyConfigs.mapEl.organicsDest.nycLabels(),journeyConfigs.mapEl.organicsDest.initial=!0})}))},journeyConfigs.mapEl.organicsDest.nycLabels=function(){journeyConfigs.mapEl.organicsDest.initial===!1&&(u.selectAll(".legend-destination").transition().duration(1500).attr("opacity",1),u.selectAll("text-labels").data(n.features).enter().append("text").attr("x",function(t){return l([t.geometry.coordinates[0],t.geometry.coordinates[1]])[0]}).attr("y",function(t){return l([t.geometry.coordinates[0],t.geometry.coordinates[1]])[1]}).attr("transform",function(t){return 3==t.properties.id?"translate(-10,0)":"translate(10,0)"}).attr("text-anchor",function(t,e){return 3==t.properties.id?"end":"beginning"}).attr("alignment-baseline","middle").attr("class","legend-organics map-legend").text(function(t,e){return t.properties.name}),u.selectAll("text-labels-below").data(n.features).enter().append("text").attr("x",function(t){return l([t.geometry.coordinates[0],t.geometry.coordinates[1]])[0]}).attr("y",function(t){return l([t.geometry.coordinates[0],t.geometry.coordinates[1]])[1]}).attr("transform",function(t){var e=a?10:15;return 3==t.properties.id?"translate(-10,"+e+")":"translate(10,"+e+")"}).attr("text-anchor",function(t,e){return 3==t.properties.id?"end":"beginning"}).attr("alignment-baseline","middle").attr("class","legend-organics map-legend").text(function(t,e){if(t.properties.long_name)return t.properties.long_name}),journeyConfigs.mapEl.organicsDest.out(),journeyConfigs.mapEl.organicsDest.zoom=!0)},journeyConfigs.mapEl.organicsDest.out=function(){journeyConfigs.mapEl.organicsDest.zoom===!1&&setTimeout(function(){journeyConfigs.mapEl.organicsDest.animationPlayed=!1,journeyConfigs.mapEl.organicsDest.initial=!1,journeyConfigs.mapEl.organicsDest.zoom=!1},1600)}}function m(t,n,o,r){var i=.99*$(".map-dropoff").width(),l=e,c=d3.geo.albers().scale(1).translate([0,0]),p=d3.geo.path().projection(c),g=p.bounds(t),d=.8,f=d/Math.max((g[1][0]-g[0][0])/i,(g[1][1]-g[0][1])/l),u=[(i-f*(g[1][0]+g[0][0]))/2,(l-f*(g[1][1]+g[0][1]))/2];c.scale(f).translate(u),d3.select("#map-dropoff-svg")&&d3.select("#map-dropoff-svg").remove();var y=d3.select(".map-dropoff").append("svg").attr("width",i).attr("height",l).attr("id","map-dropoff-svg").on("click",function(t){journeyConfigs.mapEl.dropOff.startAnimation()});$("#map-dropoff-svg").css({position:"absolute",top:-s});var m=(y.append("circle").attr("cx",i/2).attr("cy",l/2).attr("r",i/2).style("fill",journeyConfigs.mapConfigs.colors.background).attr("stroke-width",0),y.append("clipPath").attr("id","mapClip").append("circle").attr("cx",i/2).attr("cy",l/2).attr("r",i/2),y.append("g").attr("class","mapGroup").attr("clip-path","url(#mapClip)")),h=m.append("g").attr("class","usStates"),C=m.append("g").attr("class","commDist"),j=m.append("g").attr("class","communityGardens"),w=m.append("g").attr("class","dropOffSites");h.selectAll(".usStates").data(r.features).enter().append("path").attr({d:p}).style("stroke","black").style("stroke-width",0).style("fill",journeyConfigs.mapConfigs.colors.land).attr("class","usStates"),C.selectAll(".nycd").data(n.features).enter().append("path").attr({d:p}).style("stroke","black").style("stroke-width",0).style("fill",function(t,e){return journeyConfigs.mapConfigs.colors.land}).attr("class","nycd"),w.selectAll(".dropOffSites").data(t.features).enter().append("circle").attr("cx",function(t){return c([t.geometry.coordinates[0],t.geometry.coordinates[1]])[0]}).attr("cy",function(t){return c([t.geometry.coordinates[0],t.geometry.coordinates[1]])[1]}).attr("r",0).style("stroke","#fff").style("stroke-width",1).style("fill",function(t,e){return"market"===t.properties.type?journeyConfigs.mapConfigs.colors.wasteCircles:journeyConfigs.mapConfigs.colors.complementary}).attr("class","dropOffSites"),j.selectAll(".communityGardens").data(o.features).enter().append("circle").attr("cx",function(t){return c([t.geometry.coordinates[0],t.geometry.coordinates[1]])[0]}).attr("cy",function(t){return c([t.geometry.coordinates[0],t.geometry.coordinates[1]])[1]}).attr("r",0).style("stroke","#fff").style("stroke-width",1).style("fill",journeyConfigs.mapConfigs.colors.complementaryOpacity).attr("class","communityGardens");var b=["Organics drop-off sites"],E=["Markets","Other"],x=20,_=20,A=10,k=a?0:60,v=l/2,D=(y.selectAll("dropOffLegendTitle").data(b).enter().append("text").attr("class","map-legend legend-dropoff").attr("id","dropoff-legend-title").attr("x",k).attr("y",v-A).text(function(t,e){return b[e]}).attr("opacity",0),y.selectAll("dropOffLegend").data(journeyConfigs.mapConfigs.colors.scaleDropOff).enter().append("g").attr("class","map-legend legend-dropoff").attr("id",function(t,e){return"dropoff-legend-"+e}).attr("opacity",0));D.append("rect").attr("class","legend-dropoff").attr("x",k).attr("y",function(t,e){return v+e*_+e*A}).attr("width",x).attr("height",_).style("fill",function(t,e){return t}),D.append("text").attr("class","legend-dropoff").attr("x",k+x+A).attr("y",function(t,e){return v+e*_+13+e*A}).text(function(t,e){return E[e]}),journeyConfigs.mapEl.dropOff.animationPlayed=!1,journeyConfigs.mapEl.dropOff.gardensPlayed=!1,journeyConfigs.mapEl.dropOff.startAnimation=function(){journeyConfigs.mapEl.dropOff.animationPlayed||(journeyConfigs.mapEl.dropOff.animationPlayed=!0,w.selectAll(".dropOffSites").each(function(t,e){d3.select(this).attr("r",0)}),j.selectAll(".communityGardens").each(function(t,e){d3.select(this).attr("r",0)}),y.selectAll(".map-legend").attr("opacity",0),w.selectAll(".dropOffSites").each(function(t,e){d3.select(this).transition().duration(1500).attr("r",3).each("end",function(){d3.select("#dropoff-legend-0").attr("opacity",1),d3.select("#dropoff-legend-title").attr("opacity",1),d3.select("#dropoff-legend-1").attr("opacity",1),journeyConfigs.mapEl.dropOff.out(),journeyConfigs.mapEl.dropOff.gardensPlayed=!0})}))},journeyConfigs.mapEl.dropOff.gardens=function(){journeyConfigs.mapEl.dropOff.gardensPlayed===!1&&j.selectAll(".communityGardens").each(function(t,e){d3.select(this).transition().duration(1500).attr("r",3).each("end",function(){d3.select("#dropoff-legend-title").attr("opacity",1),d3.select("#dropoff-legend-1").attr("opacity",1),journeyConfigs.mapEl.dropOff.out()})})},journeyConfigs.mapEl.dropOff.out=function(){setTimeout(function(){journeyConfigs.mapEl.dropOff.animationPlayed=!1,journeyConfigs.mapEl.dropOff.gardensPlayed=!1},1600)}}journeyConfigs.mapConfigs.colors={background:"#edf0ff",land:"#d9d9d9",wasteLines:"#f15a29",wasteCircles:"#f15a29",wasteOpacity:"#e3a793",complementary:"#1485CC",complementaryOpacity:"#8bb8d5",scale:["#992D09","#FF885E","#FFBDA6","#8bb8d5"],scaleDropOff:["#f15a29","#1485CC"]},journeyConfigs.mapConfigs.scales={circleRadius:function(t){return.025*Math.sqrt(t/3.14)*2},lineWidth:function(t){return journeyConfigs.mapConfigs.scales.circleRadius(t)/2}},d3.json(journeyConfigs.mapDataPath,function(t){var e=t.nycd_organics_collection,n=t.nyc_organics_drop_off_by_type,a=t.nyc_community_gardens,o=t.organics_destinations,r=t.ny_nj_ct_refined,i=t.states_east_census;u(e,r),y(e,o,i),m(n,e,a,r)})}var visImageSizes=[{height:600,width:634,type:"jpg",filename:"600_brown-bin-collection.jpg"},{height:600,width:1590,type:"jpg",filename:"600_community-composting.jpg"},{height:600,width:1754,type:"jpg",filename:"600_community-farm.jpg"},{height:600,width:866,type:"jpg",filename:"600_digester.jpg"},{height:600,width:805,type:"jpg",filename:"600_drop-off.jpg"},{height:600,width:240,type:"jpg",filename:"600_filling-brown-bin-l.jpg"},{height:600,width:42,type:"jpg",filename:"600_filling-brown-bin-r.jpg"},{height:600,width:280,type:"jpg",filename:"600_filling-brown-bin.jpg"},{height:600,width:1175,type:"jpg",filename:"600_si-frontloader.jpg"},{height:600,width:981,type:"jpg",filename:"600_si-tipping.jpg"},{height:600,width:864,type:"jpg",filename:"600_using-compost.jpg"},{height:600,width:1547,type:"jpg",filename:"600_windrow.jpg"},{height:800,width:845,type:"jpg",filename:"800_brown-bin-collection.jpg"},{height:800,width:2120,type:"jpg",filename:"800_community-composting.jpg"},{height:800,width:2339,type:"jpg",filename:"800_community-farm.jpg"},{height:800,width:1155,type:"jpg",filename:"800_digester.jpg"},{height:800,width:1073,type:"jpg",filename:"800_drop-off.jpg"},{height:800,width:320,type:"jpg",filename:"800_filling-brown-bin-l.jpg"},{height:800,width:56,type:"jpg",filename:"800_filling-brown-bin-r.jpg"},{height:800,width:373,type:"jpg",filename:"800_filling-brown-bin.jpg"},{height:800,width:1567,type:"jpg",filename:"800_si-frontloader.jpg"},{height:800,width:1308,type:"jpg",filename:"800_si-tipping.jpg"},{height:800,width:1152,type:"jpg",filename:"800_using-compost.jpg"},{height:800,width:2062,type:"jpg",filename:"800_windrow.jpg"}],journeyConfigs={};journeyConfigs.meta={name:"Organics",slug:"organics",id:1},journeyConfigs.firstPanelId="panel-0-1",journeyConfigs.mapEl={organicsColl:{id:"0-5"},organicsDest:{id:"0-9"},dropOff:{id:"3-1"}},journeyConfigs.mapDataPath="data/organics.geojson",journeyConfigs.mapConfigs={};