"use strict";function initMaps(t,e,n,r,a,o,i,s,l,c,p,d,f,u){function g(t,n,a){var o=.99*$(".map-cnd-ts").width(),i=e,l=d3.geo.albers().scale(1).translate([0,0]),c=d3.geo.path().projection(l),p=c.bounds(a),d=.8,f=d/Math.max((p[1][0]-p[0][0])/o,(p[1][1]-p[0][1])/i),u=[(o-f*(p[1][0]+p[0][0]))/2,(i-f*(p[1][1]+p[0][1]))/2];l.scale(f).translate(u),d3.select("#map-cnd-ts-svg")&&d3.select("#map-cnd-ts-svg").remove();var g=d3.select(".map-cnd-ts").append("svg").attr("width",o).attr("height",i).attr("id","map-cnd-ts-svg").on("click",function(t){journeyConfigs.mapEl.cndTS.startAnimation()});$("#map-cnd-ts-svg").css({position:"absolute",top:-s});var y=(g.append("circle").attr("cx",o/2).attr("cy",i/2).attr("r",o/2).style("fill",journeyConfigs.mapConfigs.colors.background).attr("stroke-width",0),g.append("clipPath").attr("id","mapClip").append("circle").attr("cx",o/2).attr("cy",i/2).attr("r",o/2),g.append("g").attr("class","mapGroup").attr("clip-path","url(#mapClip)")),m=y.append("g").attr("class","usStates"),h=y.append("g").attr("class","commDist"),C=y.append("g").attr("class","tsNotCnd"),j=y.append("g").attr("class","tsCnd");m.selectAll(".usStates").data(n.features).enter().append("path").attr({d:c}).style("stroke","black").style("stroke-width",0).style("fill",journeyConfigs.mapConfigs.colors.land).attr("class","usStates"),h.selectAll(".nycd").data(t.features).enter().append("path").attr({d:c}).style("stroke","black").style("stroke-width",0).style("fill",function(t,e){return journeyConfigs.mapConfigs.colors.land}).attr("class","nycd"),C.selectAll(".tsNotCnd").data(a.features).enter().append("circle").filter(function(t){return"C&D"!==t.properties.ac_desc_si}).attr("cx",function(t){return l([t.geometry.coordinates[0],t.geometry.coordinates[1]])[0]}).attr("cy",function(t){return l([t.geometry.coordinates[0],t.geometry.coordinates[1]])[1]}).attr("r",function(t,e){return 0}).style("stroke","#fff").style("stroke-width",1).style("fill",journeyConfigs.mapConfigs.colors.complementaryOpacity).attr("opacity",.7).attr("class","tsNotCnd"),j.selectAll(".tsCnd").data(a.features).enter().append("circle").filter(function(t){return"C&D"===t.properties.ac_desc_si}).attr("cx",function(t){return l([t.geometry.coordinates[0],t.geometry.coordinates[1]])[0]}).attr("cy",function(t){return l([t.geometry.coordinates[0],t.geometry.coordinates[1]])[1]}).attr("r",function(t,e){return 0}).style("stroke","#fff").style("stroke-width",1).style("fill",journeyConfigs.mapConfigs.colors.wasteCircles).attr("opacity",.7).attr("class","tsCnd");var x=["Facilities in NYC, scaled"],_=["by tons of waste received"],E=["Transfer station","C&D debris processing"],k=10,w=10,P=10,T=r?8:30,v=.4*i,S=(g.selectAll("routeLegendTitle").data(x).enter().append("text").attr("class","map-legend legend-route").attr("id","legend-route-title").attr("x",T).attr("y",v-2.5*P-5).text(function(t,e){return x[e]}).attr("opacity",1),g.selectAll("routeLegendTitle").data(_).enter().append("text").attr("class","map-legend legend-route").attr("id","legend-route-title").attr("x",T).attr("y",v-P-5).text(function(t,e){return _[e]}).attr("opacity",1),g.selectAll("tsLegend").data(journeyConfigs.mapConfigs.colors.scaleTS).enter().append("g").attr("class","map-legend legend-ts").attr("id",function(t,e){return"legend-ts-"+e}).attr("opacity",1));S.append("circle").attr("class","legend-ts").attr("cx",T+k/2).attr("cy",function(t,e){return v+e*w+e*P+k/2}).attr("r",k/2).style("stroke","#fff").style("stroke-width",1).style("fill",function(t,e){return t}),S.append("text").attr("class","legend-ts").attr("x",T+k+P).attr("y",function(t,e){return v+e*w+10+e*P}).text(function(t,e){return E[e]}),journeyConfigs.mapEl.cndTS.animationPlayed=!1,journeyConfigs.mapEl.cndTS.otherPointsPlayed=!1,journeyConfigs.mapEl.cndTS.outPlayed=!1,journeyConfigs.mapEl.cndTS.startAnimation=function(){journeyConfigs.mapEl.cndTS.animationPlayed||(journeyConfigs.mapEl.cndTS.animationPlayed=!0,C.selectAll(".tsNotCnd").each(function(t,e){d3.select(this).attr("r",0)}),j.selectAll(".tsCnd").each(function(t,e){d3.select(this).attr("r",0)}),C.selectAll(".tsNotCnd").each(function(t,e){d3.select(this).filter(function(t){return"C&D"!==t.properties.ac_desc_si}).attr("r",0).transition().duration(1500).attr("r",function(t){return journeyConfigs.mapConfigs.scales.circleRadius(t.properties.rec_2014)}).each("end",function(t,e){journeyConfigs.mapEl.cndTS.otherPoints(),journeyConfigs.mapEl.cndTS.otherPointsPlayed=!0})}))},journeyConfigs.mapEl.cndTS.otherPoints=function(){journeyConfigs.mapEl.cndTS.otherPointsPlayed||(d3.select("#legend-ts-title").attr("opacity",1),d3.select("#legend-ts-0").attr("opacity",1),d3.select("#legend-ts-1").attr("opacity",1),j.selectAll(".tsCnd").each(function(t,e){d3.select(this).filter(function(t){return"C&D"===t.properties.ac_desc_si}).attr("r",0).transition().duration(1500).attr("r",function(t){return journeyConfigs.mapConfigs.scales.circleRadius(t.properties.rec_2014)}).each("end",function(t,e){journeyConfigs.mapEl.cndTS.out(),journeyConfigs.mapEl.cndTS.outPlayed=!0})}))},journeyConfigs.mapEl.cndTS.out=function(){journeyConfigs.mapEl.cndTS.outPlayed||setTimeout(function(){journeyConfigs.mapEl.cndTS.animationPlayed=!1,journeyConfigs.mapEl.cndTS.otherPointsPlayed=!1,journeyConfigs.mapEl.cndTS.outPlayed=!1},1600)}}function y(t,n,a){function o(t){return"Landfill"===t?journeyConfigs.mapConfigs.colors.wasteCircles:"C&D"===t?journeyConfigs.mapConfigs.colors.complementary:void 0}function i(t){return"C&D"===t||"Landfill"===t}for(var l=.99*$(".map-cnd-export").width(),c=e,p=d3.geo.mercator().scale(1).translate([0,0]),d=d3.geo.path().projection(p),f=t.features.length;f--;)i(t.features[f].properties.sent_type)||t.features.splice(f,1);for(var u=n.features.length;u--;)null===n.features[u].geometry.coordinates&&n.features.splice(u,1);var g=d.bounds(t),y=.75,m=y/Math.max((g[1][0]-g[0][0])/l,(g[1][1]-g[0][1])/c),h=[(l-m*(g[1][0]+g[0][0]))/2,(c-m*(g[1][1]+g[0][1]))/2];p.scale(m).translate(h),d3.select("#map-cnd-export-svg")&&d3.select("#map-cnd-export-svg").remove();var C=d3.select(".map-cnd-export").append("svg").attr("width",l).attr("height",c).attr("id","map-cnd-export-svg").on("click",function(t){journeyConfigs.mapEl.cndExport.startAnimation()});$("#map-cnd-export-svg").css({position:"absolute",top:-s});var j=(C.append("circle").attr("cx",l/2).attr("cy",c/2).attr("r",l/2).attr("fill",journeyConfigs.mapConfigs.colors.background).attr("stroke-width",0),C.append("clipPath").attr("id","mapClip").append("circle").attr("cx",l/2).attr("cy",c/2).attr("r",l/2),C.append("g").attr("class","mapGroup").attr("clip-path","url(#mapClip)")),x=j.append("g").attr("class","usStates"),_=j.append("g").attr("class","lineConnect"),E=j.append("g").attr("class","exportPoints");x.selectAll(".usStates").data(a.features).enter().append("path").attr({d:d}).style("stroke","#fff").style("stroke-width",1).style("fill",journeyConfigs.mapConfigs.colors.land),_.selectAll(".lineConnect").data(t.features).enter().append("path").attr({d:d,"stroke-dasharray":"0 5000"}).style("stroke",function(t,e){return o(t.properties.sent_fac_t)}).attr("stroke-width",function(t){return i(t.properties.sent_type)?journeyConfigs.mapConfigs.scales.lineWidth(t.properties.sent_tons_)/2:0}).style("fill","none").attr("stroke-dasharray",function(t){return this.getTotalLength()+" "+this.getTotalLength()}).attr("stroke-dashoffset",function(t){return-this.getTotalLength()}).attr("class","lineConnect"),E.selectAll(".exportPoints").data(n.features).enter().append("circle").attr("cx",function(t){return p([t.geometry.coordinates[0],t.geometry.coordinates[1]])[0]}).attr("cy",function(t){return p([t.geometry.coordinates[0],t.geometry.coordinates[1]])[1]}).attr("r",0).style("stroke","#fff").style("stroke-width",1).style("fill",function(t,e){return o(t.properties.sent_fac_t)}).attr("opacity",function(t){return i(t.properties.sent_fac_t)?1:0}).attr("class","exportPoints");var k=["Destination type"],w=["Landfill","C&D processor"],P=10,T=10,v=10,S=r?l-.3*l:l-.2*l,A=.7*c,b=(C.selectAll("exportLegendTitle").data(k).enter().append("text").attr("class","map-legend legend-export").attr("id","legend-export-title").attr("x",S).attr("y",A-v).text(function(t,e){return k[e]}).attr("opacity",1),C.selectAll("exportLegend").data(journeyConfigs.mapConfigs.colors.scaleExport).enter().append("g").attr("class","map-legend legend-export").attr("id",function(t,e){return"legend-export-"+e}).attr("opacity",1));b.append("circle").attr("class","legend-export").attr("cx",S+P/2).attr("cy",function(t,e){return A+e*T+e*v+P/2}).attr("r",P/2).style("stroke","#fff").style("stroke-width",1).style("fill",function(t,e){return t}),b.append("text").attr("class","legend-export").attr("x",S+P+v).attr("y",function(t,e){return A+e*T+10+e*v}).text(function(t,e){return w[e]}),journeyConfigs.mapEl.cndExport.animationPlayed=!1,journeyConfigs.mapEl.cndExport.transitionCirclesPlayed=!1,journeyConfigs.mapEl.cndExport.linesOutPlayed=!1,journeyConfigs.mapEl.cndExport.startAnimation=function(){journeyConfigs.mapEl.cndExport.animationPlayed||(journeyConfigs.mapEl.cndExport.animationPlayed=!0,E.selectAll(".exportPoints").each(function(t,e){d3.select(this).attr("r",0)}),_.selectAll(".lineConnect").each(function(t,e){d3.select(this).attr("stroke-dasharray",function(t){return this.getTotalLength()+" "+this.getTotalLength()}).attr("stroke-dashoffset",function(t){return-this.getTotalLength()}).attr("class","lineConnect").transition().duration(1500).attr("stroke-dashoffset",0).each("end",function(){journeyConfigs.mapEl.cndExport.transitionCircles(),journeyConfigs.mapEl.cndExport.transitionCirclesPlayed=!0})}))},journeyConfigs.mapEl.cndExport.transitionCircles=function(){journeyConfigs.mapEl.cndExport.transitionCirclesPlayed||E.selectAll(".exportPoints").each(function(t,e){d3.select(this).attr("r",0).transition().duration(1500).attr("r",function(t){return journeyConfigs.mapConfigs.scales.circleRadius(t.properties.sent_tons_)}).each("end",function(){journeyConfigs.mapEl.cndExport.linesOut(),journeyConfigs.mapEl.cndExport.linesOutPlayed=!0})})},journeyConfigs.mapEl.cndExport.linesOut=function(){journeyConfigs.mapEl.cndExport.linesOutPlayed||(_.selectAll(".lineConnect").each(function(t,e){d3.select(this).attr("stroke-dasharray",function(t){return this.getTotalLength()+" "+this.getTotalLength()}).attr("stroke-dashoffset",0).attr("class","lineConnect").transition().duration(1500).attr("stroke-dashoffset",function(t){return this.getTotalLength()})}),setTimeout(function(){journeyConfigs.mapEl.cndExport.animationPlayed=!1,journeyConfigs.mapEl.cndExport.transitionCirclesPlayed=!1,journeyConfigs.mapEl.cndExport.linesOutPlayed=!1},1600))}}var m=r?1:1.5;journeyConfigs.mapConfigs.colors={background:"#edf0ff",land:"#d9d9d9",wasteLines:"#f15a29",wasteCircles:"#f15a29",wasteOpacity:"#e3a793",complementary:"#1485CC",complementaryOpacity:"#8bb8d5",scale:["#8bb8d5","#1485CC","#f15a29"],scaleTS:["#8bb8d5","#f15a29"],scaleExport:["#f15a29","#1485CC"],scaleDropOff:["#f15a29","#1485CC"]},journeyConfigs.mapConfigs.scales={circleRadius:function(t){return.025*Math.sqrt(t/3.14)*m},lineWidth:function(t){return journeyConfigs.mapConfigs.scales.circleRadius(t)*m}},d3.json(journeyConfigs.mapDataPath,function(t){var e=t.nycd_bcd,n=t.ny_nj_ct_refined,r=(t.od_lines_refuse,t.comm_truck_routes_lines,t.comm_truck_routes_points,t.all_transfer_stations),a=t.dest_lines,o=t.export_points,i=t.states_east;g(e,n,r),y(a,o,i)})}var visImageSizes=[{height:600,width:272,type:"jpg",filename:"600_demolition-l-nm.jpg"},{height:600,width:151,type:"jpg",filename:"600_demolition-l.jpg"},{height:600,width:826,type:"jpg",filename:"600_demolition-r-nm.jpg"},{height:600,width:948,type:"jpg",filename:"600_demolition-r.jpg"},{height:600,width:1937,type:"jpg",filename:"600_excavation.jpg"},{height:600,width:872,type:"jpg",filename:"600_mini-dumpsters.jpg"},{height:600,width:644,type:"jpg",filename:"600_pickup-rear.jpg"},{height:600,width:1067,type:"jpg",filename:"600_pickup.jpg"},{height:600,width:1533,type:"jpg",filename:"600_processing-facility-inside.jpg"},{height:600,width:1205,type:"jpg",filename:"600_processing-facility-outside.jpg"},{height:800,width:363,type:"jpg",filename:"800_demolition-l-nm.jpg"},{height:800,width:201,type:"jpg",filename:"800_demolition-l.jpg"},{height:800,width:1101,type:"jpg",filename:"800_demolition-r-nm.jpg"},{height:800,width:1264,type:"jpg",filename:"800_demolition-r.jpg"},{height:800,width:2583,type:"jpg",filename:"800_excavation.jpg"},{height:800,width:1162,type:"jpg",filename:"800_mini-dumpsters.jpg"},{height:800,width:858,type:"jpg",filename:"800_pickup-rear.jpg"},{height:800,width:1422,type:"jpg",filename:"800_pickup.jpg"},{height:800,width:2044,type:"jpg",filename:"800_processing-facility-inside.jpg"},{height:800,width:1606,type:"jpg",filename:"800_processing-facility-outside.jpg"}],journeyConfigs={};journeyConfigs.meta={name:"Construction and Demolition",slug:"cnd",id:1},journeyConfigs.firstPanelId="panel-0-1",journeyConfigs.mapEl={cndTS:{id:"0-8"},cndExport:{id:"2-1"}},journeyConfigs.mapDataPath="data/cnd.geojson",journeyConfigs.mapConfigs={};